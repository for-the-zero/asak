"use strict";require("react");var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var r=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}),r}var n={exports:{}},s={},o={};Object.defineProperty(o,"__esModule",{value:!0}),o.RFC3986=o.RFC1738=o.formatters=o.default_format=void 0,o.default_format="RFC3986",o.formatters={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},o.RFC1738="RFC1738",o.RFC3986="RFC3986";var i={},a={};Object.defineProperty(a,"__esModule",{value:!0}),a.maybe_map=a.combine=a.is_buffer=a.is_regexp=a.compact=a.encode=a.decode=a.assign_single_source=a.merge=void 0;const l=o,c=Object.prototype.hasOwnProperty,u=Array.isArray,d=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();a.merge=function e(t,r,n={}){if(!r)return t;if("object"!=typeof r){if(u(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!c.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);let s=t;return u(t)&&!u(r)&&(s=function(e,t){const r=t&&t.plainObjects?Object.create(null):{};for(let t=0;t<e.length;++t)void 0!==e[t]&&(r[t]=e[t]);return r}(t,n)),u(t)&&u(r)?(r.forEach(function(r,s){if(c.call(t,s)){const o=t[s];o&&"object"==typeof o&&r&&"object"==typeof r?t[s]=e(o,r,n):t.push(r)}else t[s]=r}),t):Object.keys(r).reduce(function(t,s){const o=r[s];return c.call(t,s)?t[s]=e(t[s],o,n):t[s]=o,t},s)},a.assign_single_source=function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},a.decode=function(e,t,r){const n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}};const f=1024;a.encode=(e,t,r,n,s)=>{if(0===e.length)return e;let o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===r)return escape(o).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let e=0;e<o.length;e+=f){const t=o.length>=f?o.slice(e,e+f):o,r=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||s===l.RFC1738&&(40===n||41===n)?r[r.length]=t.charAt(e):n<128?r[r.length]=d[n]:n<2048?r[r.length]=d[192|n>>6]+d[128|63&n]:n<55296||n>=57344?r[r.length]=d[224|n>>12]+d[128|n>>6&63]+d[128|63&n]:(e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),r[r.length]=d[240|n>>18]+d[128|n>>12&63]+d[128|n>>6&63]+d[128|63&n])}i+=r.join("")}return i},a.compact=function(e){const t=[{obj:{o:e},prop:"o"}],r=[];for(let e=0;e<t.length;++e){const n=t[e],s=n.obj[n.prop],o=Object.keys(s);for(let e=0;e<o.length;++e){const n=o[e],i=s[n];"object"==typeof i&&null!==i&&-1===r.indexOf(i)&&(t.push({obj:s,prop:n}),r.push(i))}}return function(e){for(;e.length>1;){const t=e.pop();if(!t)continue;const r=t.obj[t.prop];if(u(r)){const e=[];for(let t=0;t<r.length;++t)void 0!==r[t]&&e.push(r[t]);t.obj[t.prop]=e}}}(t),e},a.is_regexp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},a.is_buffer=function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},a.combine=function(e,t){return[].concat(e,t)},a.maybe_map=function(e,t){if(u(e)){const r=[];for(let n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},Object.defineProperty(i,"__esModule",{value:!0}),i.stringify=void 0;const p=a,h=o,m=Object.prototype.hasOwnProperty,g={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},b=Array.isArray,y=Array.prototype.push,_=function(e,t){y.apply(e,b(t)?t:[t])},v=Date.prototype.toISOString,w={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:p.encode,encodeValuesOnly:!1,format:h.default_format,formatter:h.formatters[h.default_format],indices:!1,serializeDate:e=>v.call(e),skipNulls:!1,strictNullHandling:!1};const P={};function O(e,t,r,n,s,o,i,a,l,c,u,d,f,h,m,g,y,v){let A=e,j=v,R=0,E=!1;for(;void 0!==(j=j.get(P))&&!E;){const t=j.get(e);if(R+=1,void 0!==t){if(t===R)throw new RangeError("Cyclic object value");E=!0}void 0===j.get(P)&&(R=0)}if("function"==typeof c?A=c(t,A):A instanceof Date?A=f?.(A):"comma"===r&&b(A)&&(A=(0,p.maybe_map)(A,function(e){return e instanceof Date?f?.(e):e})),null===A){if(o)return l&&!g?l(t,w.encoder,y,"key",h):t;A=""}if("string"==typeof(I=A)||"number"==typeof I||"boolean"==typeof I||"symbol"==typeof I||"bigint"==typeof I||(0,p.is_buffer)(A)){if(l){const e=g?t:l(t,w.encoder,y,"key",h);return[m?.(e)+"="+m?.(l(A,w.encoder,y,"value",h))]}return[m?.(t)+"="+m?.(String(A))]}var I;const S=[];if(void 0===A)return S;let C;if("comma"===r&&b(A))g&&l&&(A=(0,p.maybe_map)(A,l)),C=[{value:A.length>0?A.join(",")||null:void 0}];else if(b(c))C=c;else{const e=Object.keys(A);C=u?e.sort(u):e}const x=a?String(t).replace(/\./g,"%2E"):String(t),M=n&&b(A)&&1===A.length?x+"[]":x;if(s&&b(A)&&0===A.length)return M+"[]";for(let t=0;t<C.length;++t){const p=C[t],w="object"==typeof p&&void 0!==p.value?p.value:A[p];if(i&&null===w)continue;const j=d&&a?p.replace(/\./g,"%2E"):p,E=b(A)?"function"==typeof r?r(M,j):M:M+(d?"."+j:"["+j+"]");v.set(e,R);const I=new WeakMap;I.set(P,v),_(S,O(w,E,r,n,s,o,i,a,"comma"===r&&g&&b(A)?null:l,c,u,d,f,h,m,g,y,I))}return S}i.stringify=function(e,t={}){let r=e;const n=function(e=w){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||w.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=h.default_format;if(void 0!==e.format){if(!m.call(h.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}const n=h.formatters[r];let s,o=w.filter;if(("function"==typeof e.filter||b(e.filter))&&(o=e.filter),s=e.arrayFormat&&e.arrayFormat in g?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":w.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=void 0===e.allowDots?1==!!e.encodeDotInKeys||w.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:w.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:w.allowEmptyArrays,arrayFormat:s,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:w.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?w.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:w.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:w.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:w.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:w.encodeValuesOnly,filter:o,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:w.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:w.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:w.strictNullHandling}}(t);let s,o;"function"==typeof n.filter?(o=n.filter,r=o("",r)):b(n.filter)&&(o=n.filter,s=o);const i=[];if("object"!=typeof r||null===r)return"";const a=g[n.arrayFormat],l="comma"===a&&n.commaRoundTrip;s||(s=Object.keys(r)),n.sort&&s.sort(n.sort);const c=new WeakMap;for(let e=0;e<s.length;++e){const t=s[e];n.skipNulls&&null===r[t]||_(i,O(r[t],t,a,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}const u=i.join(n.delimiter);let d=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),u.length>0?d+u:""},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formats=e.stringify=void 0;const t=o,r={formatters:t.formatters,RFC1738:t.RFC1738,RFC3986:t.RFC3986,default:t.default_format};e.formats=r;var n=i;Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}})}(s);var A,j={},R={};var E={},I={};let S,C,x,M,F,k,T,$,B,D,q,N,L,U=!1;var V=r(Object.freeze({__proto__:null,get auto(){return U},get kind(){return S},get fetch(){return C},get Request(){return x},get Response(){return M},get Headers(){return F},get FormData(){return k},get Blob(){return T},get File(){return $},get ReadableStream(){return B},get getMultipartRequestOptions(){return D},get getDefaultAgent(){return q},get fileFromPath(){return N},get isFsReadStream(){return L},setShims:function(e,t={auto:!1}){if(U)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(S)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${S}'\``);U=t.auto,S=e.kind,C=e.fetch,x=e.Request,M=e.Response,F=e.Headers,k=e.FormData,T=e.Blob,$=e.File,B=e.ReadableStream,D=e.getMultipartRequestOptions,q=e.getDefaultAgent,N=e.fileFromPath,L=e.isFsReadStream}})),W={},J={},H={};Object.defineProperty(H,"__esModule",{value:!0}),H.MultipartBody=void 0;class X{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}H.MultipartBody=X,Object.defineProperty(J,"__esModule",{value:!0}),J.getRuntime=void 0;const z=H;J.getRuntime=function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let r,n,s,o;try{r=fetch,n=Request,s=Response,o=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:r,Request:n,Response:s,Headers:o,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new z.MultipartBody(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}},function(t){var r=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=e&&e.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),n(J,t)}(W),function(e){const t=V,r=W;e.init=()=>{t.kind||t.setShims(r.getRuntime(),{auto:!0})};for(const r of Object.keys(t))Object.defineProperty(e,r,{get:()=>t[r]});e.init()}(I);var K,G={};function Q(){if(K)return G;K=1,Object.defineProperty(G,"__esModule",{value:!0}),G.ContentFilterFinishReasonError=G.LengthFinishReasonError=G.InternalServerError=G.RateLimitError=G.UnprocessableEntityError=G.ConflictError=G.NotFoundError=G.PermissionDeniedError=G.AuthenticationError=G.BadRequestError=G.APIConnectionTimeoutError=G.APIConnectionError=G.APIUserAbortError=G.APIError=G.OpenAIError=void 0;const e=ie();class t extends Error{}G.OpenAIError=t;class r extends t{constructor(e,t,n,s){super(`${r.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s?.["x-request-id"],this.error=t;const o=t;this.code=o?.code,this.param=o?.param,this.type=o?.type}static makeMessage(e,t,r){const n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(t,f,p,h){if(!t||!h)return new n({message:p,cause:(0,e.castToError)(f)});const m=f?.error;return 400===t?new s(t,m,p,h):401===t?new o(t,m,p,h):403===t?new i(t,m,p,h):404===t?new a(t,m,p,h):409===t?new l(t,m,p,h):422===t?new c(t,m,p,h):429===t?new u(t,m,p,h):t>=500?new d(t,m,p,h):new r(t,m,p,h)}}G.APIError=r;G.APIUserAbortError=class extends r{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}};class n extends r{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}G.APIConnectionError=n;G.APIConnectionTimeoutError=class extends n{constructor({message:e}={}){super({message:e??"Request timed out."})}};class s extends r{}G.BadRequestError=s;class o extends r{}G.AuthenticationError=o;class i extends r{}G.PermissionDeniedError=i;class a extends r{}G.NotFoundError=a;class l extends r{}G.ConflictError=l;class c extends r{}G.UnprocessableEntityError=c;class u extends r{}G.RateLimitError=u;class d extends r{}G.InternalServerError=d;G.LengthFinishReasonError=class extends t{constructor(){super("Could not parse response content as the length limit was reached")}};return G.ContentFilterFinishReasonError=class extends t{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},G}var Y,Z={};var ee,te,re={};function ne(){if(te)return E;te=1,Object.defineProperty(E,"__esModule",{value:!0}),E._iterSSEMessages=E.Stream=void 0;const t=I,r=Q(),n=function(){if(Y)return Z;Y=1;var t,r=e&&e.__classPrivateFieldSet||function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},n=e&&e.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(Z,"__esModule",{value:!0}),Z.findDoubleNewlineIndex=Z.LineDecoder=void 0;const s=Q();class o{constructor(){t.set(this,void 0),this.buffer=new Uint8Array,r(this,t,null,"f")}decode(e){if(null==e)return[];const s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?(new TextEncoder).encode(e):e;let o=new Uint8Array(this.buffer.length+s.length);o.set(this.buffer),o.set(s,this.buffer.length),this.buffer=o;const a=[];let l;for(;null!=(l=i(this.buffer,n(this,t,"f")));){if(l.carriage&&null==n(this,t,"f")){r(this,t,l.index,"f");continue}if(null!=n(this,t,"f")&&(l.index!==n(this,t,"f")+1||l.carriage)){a.push(this.decodeText(this.buffer.slice(0,n(this,t,"f")-1))),this.buffer=this.buffer.slice(n(this,t,"f")),r(this,t,null,"f");continue}const e=null!==n(this,t,"f")?l.preceding-1:l.preceding,s=this.decodeText(this.buffer.slice(0,e));a.push(s),this.buffer=this.buffer.slice(l.index),r(this,t,null,"f")}return a}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new s.OpenAIError(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new s.OpenAIError(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new s.OpenAIError("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function i(e,t){for(let r=t??0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}return Z.LineDecoder=o,t=new WeakMap,o.NEWLINE_CHARS=new Set(["\n","\r"]),o.NEWLINE_REGEXP=/\r\n|[\n\r]/g,Z.findDoubleNewlineIndex=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1},Z}(),s=(ee||(ee=1,Object.defineProperty(re,"__esModule",{value:!0}),re.ReadableStreamToAsyncIterable=void 0,re.ReadableStreamToAsyncIterable=function(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}),re),o=ie(),i=Q();class a{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;return new a(async function*(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(const r of l(e,t))if(!n)if(r.data.startsWith("[DONE]"))n=!0;else if(null===r.event||r.event.startsWith("response.")||r.event.startsWith("transcript.")){let t;try{t=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if(t&&t.error)throw new i.APIError(void 0,t.error,void 0,(0,o.createResponseHeaders)(e.headers));yield t}else{let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if("error"==r.event)throw new i.APIError(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}},t)}static fromReadableStream(e,t){let r=!1;return new a(async function*(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let o=!1;try{for await(const t of async function*(){const t=new n.LineDecoder,r=(0,s.ReadableStreamToAsyncIterable)(e);for await(const e of r)for(const r of t.decode(e))yield r;for(const e of t.flush())yield e}())o||t&&(yield JSON.parse(t));o=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{o||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){const n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new a(()=>n(e),this.controller),new a(()=>n(t),this.controller)]}toReadableStream(){const e=this;let r;const n=new TextEncoder;return new t.ReadableStream({async start(){r=e[Symbol.asyncIterator]()},async pull(e){try{const{value:t,done:s}=await r.next();if(s)return e.close();const o=n.encode(JSON.stringify(t)+"\n");e.enqueue(o)}catch(t){e.error(t)}},async cancel(){await(r.return?.())}})}}async function*l(e,t){if(!e.body)throw t.abort(),new r.OpenAIError("Attempted to iterate over a response with no body");const o=new c,i=new n.LineDecoder,a=(0,s.ReadableStreamToAsyncIterable)(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const r of e){if(null==r)continue;const e=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?(new TextEncoder).encode(r):r;let s,o=new Uint8Array(t.length+e.length);for(o.set(t),o.set(e,t.length),t=o;-1!==(s=(0,n.findDoubleNewlineIndex)(t));)yield t.slice(0,s),t=t.slice(s)}t.length>0&&(yield t)}(a))for(const t of i.decode(e)){const e=o.decode(t);e&&(yield e)}for(const e of i.flush()){const t=o.decode(e);t&&(yield t)}}E.Stream=a,E._iterSSEMessages=l;class c{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=function(e,t){const r=e.indexOf(t);if(-1!==r)return[e.substring(0,r),t,e.substring(r+t.length)];return[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}return E}var se,oe={};function ie(){return se||(se=1,function(t){var r,n=e&&e.__classPrivateFieldSet||function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},s=e&&e.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0}),t.isObj=t.toFloat32Array=t.toBase64=t.getHeader=t.getRequiredHeader=t.isHeadersProtocol=t.isRunningInBrowser=t.debug=t.hasOwn=t.isEmptyObj=t.maybeCoerceBoolean=t.maybeCoerceFloat=t.maybeCoerceInteger=t.coerceBoolean=t.coerceFloat=t.coerceInteger=t.readEnv=t.ensurePresent=t.castToError=t.sleep=t.safeJSON=t.isRequestOptions=t.createResponseHeaders=t.PagePromise=t.AbstractPage=t.APIClient=t.APIPromise=t.createForm=t.multipartFormRequestOptions=t.maybeMultipartFormRequestOptions=void 0;const o=(A||(A=1,Object.defineProperty(R,"__esModule",{value:!0}),R.VERSION=void 0,R.VERSION="4.98.0"),R),i=ne(),a=Q(),l=I;(0,l.init)();const c=oe;var u=oe;async function d(e){const{response:t}=e;if(e.options.stream)return M("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):i.Stream.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const r=t.headers.get("content-type"),n=r?.split(";")[0]?.trim();if(n?.includes("application/json")||n?.endsWith("+json")){const e=await t.json();return M("response",t.status,t.url,t.headers,e),f(e,t)}const s=await t.text();return M("response",t.status,t.url,t.headers,s),s}function f(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}Object.defineProperty(t,"maybeMultipartFormRequestOptions",{enumerable:!0,get:function(){return u.maybeMultipartFormRequestOptions}}),Object.defineProperty(t,"multipartFormRequestOptions",{enumerable:!0,get:function(){return u.multipartFormRequestOptions}}),Object.defineProperty(t,"createForm",{enumerable:!0,get:function(){return u.createForm}});class p extends Promise{constructor(e,t=d){super(e=>{e(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new p(this.responsePromise,async t=>f(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}t.APIPromise=p;t.APIClient=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:n,fetch:s}){this.baseURL=e,this.maxRetries=j("maxRetries",t),this.timeout=j("timeout",r),this.httpAgent=n,this.fetch=s??l.fetch}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...w(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${F()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async r=>{const n=r&&(0,c.isBlobLike)(r?.body)?new DataView(await r.body.arrayBuffer()):r?.body instanceof DataView?r.body:r?.body instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r?.body)?new DataView(r.body.buffer):r?.body;return{method:e,path:t,...r,body:n}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){return(new TextEncoder).encode(e).length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const r={...e},{method:n,path:s,query:o,headers:i={}}=r,a=ArrayBuffer.isView(r.body)||r.__binaryRequest&&"string"==typeof r.body?r.body:(0,c.isMultipartBody)(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,u=this.calculateContentLength(a),d=this.buildURL(s,o);"timeout"in r&&j("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const f=r.httpAgent??this.httpAgent??(0,l.getDefaultAgent)(d),p=r.timeout+1e3;"number"==typeof f?.options?.timeout&&p>(f.options.timeout??0)&&(f.options.timeout=p),this.idempotencyHeader&&"get"!==n&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);return{req:{method:n,...a&&{body:a},headers:this.buildHeaders({options:r,headers:i,contentLength:u,retryCount:t}),...f&&{agent:f},signal:r.signal??null},url:d,timeout:r.timeout}}buildHeaders({options:e,headers:r,contentLength:n,retryCount:s}){const o={};n&&(o["content-length"]=n);const i=this.defaultHeaders(e);return C(o,i),C(o,r),(0,c.isMultipartBody)(e.body)&&"node"!==l.kind&&delete o["content-type"],void 0===(0,t.getHeader)(i,"x-stainless-retry-count")&&void 0===(0,t.getHeader)(r,"x-stainless-retry-count")&&(o["x-stainless-retry-count"]=String(s)),void 0===(0,t.getHeader)(i,"x-stainless-timeout")&&void 0===(0,t.getHeader)(r,"x-stainless-timeout")&&e.timeout&&(o["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(o,r),o}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(e=>[...e])):{...e}:{}}makeStatusError(e,t,r,n){return a.APIError.generate(e,t,r,n)}request(e,t=null){return new p(this.makeRequest(e,t))}async makeRequest(e,r){const n=await e,s=n.maxRetries??this.maxRetries;null==r&&(r=s),await this.prepareOptions(n);const{req:o,url:i,timeout:l}=this.buildRequest(n,{retryCount:s-r});if(await this.prepareRequest(o,{url:i,options:n}),M("request",i,n,o.headers),n.signal?.aborted)throw new a.APIUserAbortError;const c=new AbortController,u=await this.fetchWithTimeout(i,o,l,c).catch(t.castToError);if(u instanceof Error){if(n.signal?.aborted)throw new a.APIUserAbortError;if(r)return this.retryRequest(n,r);if("AbortError"===u.name)throw new a.APIConnectionTimeoutError;throw new a.APIConnectionError({cause:u})}const d=(0,t.createResponseHeaders)(u.headers);if(!u.ok){if(r&&this.shouldRetry(u)){return M(`response (error; ${`retrying, ${r} attempts remaining`})`,u.status,i,d),this.retryRequest(n,r,d)}const e=await u.text().catch(e=>(0,t.castToError)(e).message),s=(0,t.safeJSON)(e),o=s?void 0:e;M(`response (error; ${r?"(error; no more retries left)":"(error; not retryable)"})`,u.status,i,d,o);throw this.makeStatusError(u.status,s,o,d)}return{response:u,options:n,controller:c}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new m(this,r,e)}buildURL(e,t){const r=O(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return E(n)||(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new a.OpenAIError(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,n){const{signal:s,...o}=t||{};s&&s.addEventListener("abort",()=>n.abort());const i=setTimeout(()=>n.abort(),r),a={signal:n.signal,...o};return a.method&&(a.method=a.method.toUpperCase()),this.fetch.call(void 0,e,a).finally(()=>{clearTimeout(i)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||(409===e.status||(429===e.status||e.status>=500)))}async retryRequest(e,r,n){let s;const o=n?.["retry-after-ms"];if(o){const e=parseFloat(o);Number.isNaN(e)||(s=e)}const i=n?.["retry-after"];if(i&&!s){const e=parseFloat(i);s=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(s&&0<=s&&s<6e4)){const t=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(r,t)}return await(0,t.sleep)(s),this.makeRequest(e,r-1)}calculateDefaultRetryTimeoutMillis(e,t){const r=t-e;return Math.min(.5*Math.pow(2,r),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${o.VERSION}`}};class h{constructor(e,t,s,o){r.set(this,void 0),n(this,r,e,"f"),this.options=o,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new a.OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,n]of r)e.url.searchParams.set(t,n);t.query=void 0,t.path=e.url.toString()}return await s(this,r,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(r=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}t.AbstractPage=h;class m extends p{constructor(e,t,r){super(t,async t=>new r(e,t.response,await d(t),t.options))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}t.PagePromise=m;t.createResponseHeaders=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}});const g={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0};t.isRequestOptions=e=>"object"==typeof e&&null!==e&&!E(e)&&Object.keys(e).every(e=>S(g,e));const b=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o.VERSION,"X-Stainless-OS":_(Deno.build.os),"X-Stainless-Arch":y(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o.VERSION,"X-Stainless-OS":_(process.platform),"X-Stainless-Arch":y(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:r}of e){const e=r.exec(navigator.userAgent);if(e){return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":o.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};const y=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",_=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let v;const w=()=>v??(v=b());t.safeJSON=e=>{try{return JSON.parse(e)}catch(e){return}};const P=/^[a-z][a-z0-9+.-]*:/i,O=e=>P.test(e);t.sleep=e=>new Promise(t=>setTimeout(t,e));const j=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new a.OpenAIError(`${e} must be an integer`);if(t<0)throw new a.OpenAIError(`${e} must be a positive integer`);return t};t.castToError=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)};t.ensurePresent=e=>{if(null==e)throw new a.OpenAIError(`Expected a value to be given but received ${e} instead.`);return e};t.readEnv=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;t.coerceInteger=e=>{if("number"==typeof e)return Math.round(e);if("string"==typeof e)return parseInt(e,10);throw new a.OpenAIError(`Could not coerce ${e} (type: ${typeof e}) into a number`)};t.coerceFloat=e=>{if("number"==typeof e)return e;if("string"==typeof e)return parseFloat(e);throw new a.OpenAIError(`Could not coerce ${e} (type: ${typeof e}) into a number`)};t.coerceBoolean=e=>"boolean"==typeof e?e:"string"==typeof e?"true"===e:Boolean(e);t.maybeCoerceInteger=e=>{if(void 0!==e)return(0,t.coerceInteger)(e)};t.maybeCoerceFloat=e=>{if(void 0!==e)return(0,t.coerceFloat)(e)};function E(e){if(!e)return!0;for(const t in e)return!1;return!0}function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function C(e,t){for(const r in t){if(!S(t,r))continue;const n=r.toLowerCase();if(!n)continue;const s=t[r];null===s?delete e[n]:void 0!==s&&(e[n]=s)}}t.maybeCoerceBoolean=e=>{if(void 0!==e)return(0,t.coerceBoolean)(e)},t.isEmptyObj=E,t.hasOwn=S;const x=new Set(["authorization","api-key"]);function M(e,...t){if("undefined"!=typeof process&&"true"===process?.env?.DEBUG){const r=t.map(e=>{if(!e)return e;if(e.headers){const t={...e,headers:{...e.headers}};for(const r in e.headers)x.has(r.toLowerCase())&&(t.headers[r]="REDACTED");return t}let t=null;for(const r in e)x.has(r.toLowerCase())&&(t??(t={...e}),t[r]="REDACTED");return t??e});console.log(`OpenAI:DEBUG:${e}`,...r)}}t.debug=M;const F=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});t.isRunningInBrowser=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator;t.isHeadersProtocol=e=>"function"==typeof e?.get;t.getRequiredHeader=(e,r)=>{const n=(0,t.getHeader)(e,r);if(void 0===n)throw new Error(`Could not find ${r} header`);return n};t.getHeader=(e,r)=>{const n=r.toLowerCase();if((0,t.isHeadersProtocol)(e)){const t=r[0]?.toUpperCase()+r.substring(1).replace(/([^\w])(\w)/g,(e,t,r)=>t+r.toUpperCase());for(const s of[r,n,r.toUpperCase(),t]){const t=e.get(s);if(t)return t}}for(const[t,s]of Object.entries(e))if(t.toLowerCase()===n)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${r} header, using the first entry.`),s[0]):s};t.toBase64=e=>{if(!e)return"";if("undefined"!=typeof Buffer)return Buffer.from(e).toString("base64");if("undefined"!=typeof btoa)return btoa(e);throw new a.OpenAIError("Cannot generate b64 string; Expected `Buffer` or `btoa` to be defined")};t.toFloat32Array=e=>{if("undefined"!=typeof Buffer){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{const t=atob(e),r=t.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}},t.isObj=function(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}}(j)),j}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createForm=e.multipartFormRequestOptions=e.maybeMultipartFormRequestOptions=e.isMultipartBody=e.toFile=e.isUploadable=e.isBlobLike=e.isFileLike=e.isResponseLike=e.fileFromPath=void 0;const t=I;var r=I;Object.defineProperty(e,"fileFromPath",{enumerable:!0,get:function(){return r.fileFromPath}});e.isResponseLike=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;e.isFileLike=t=>null!=t&&"object"==typeof t&&"string"==typeof t.name&&"number"==typeof t.lastModified&&(0,e.isBlobLike)(t);e.isBlobLike=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;
/**
	 * Helper for creating a {@link File} to pass to an SDK upload method from a variety of different data formats
	 * @param value the raw content of the file.  Can be an {@link Uploadable}, {@link BlobLikePart}, or {@link AsyncIterable} of {@link BlobLikePart}s
	 * @param {string=} name the name of the file. If omitted, toFile will try to determine a file name from bits if possible
	 * @param {Object=} options additional properties
	 * @param {string=} options.type the MIME type of the content
	 * @param {number=} options.lastModified the last modified timestamp
	 * @returns a {@link File} with the given properties
	 */
async function n(r,n,i){if(r=await r,(0,e.isFileLike)(r))return r;if((0,e.isResponseLike)(r)){const s=await r.blob();n||(n=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file");const o=(0,e.isBlobLike)(s)?[await s.arrayBuffer()]:[s];return new t.File(o,n,i)}const a=await async function(t){let r=[];if("string"==typeof t||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)r.push(t);else if((0,e.isBlobLike)(t))r.push(await t.arrayBuffer());else{if(!o(t))throw new Error(`Unexpected data type: ${typeof t}; constructor: ${t?.constructor?.name}; props: ${function(e){const t=Object.getOwnPropertyNames(e);return`[${t.map(e=>`"${e}"`).join(", ")}]`}(t)}`);for await(const e of t)r.push(e)}return r}(r);if(n||(n=function(e){return s(e.name)||s(e.filename)||s(e.path)?.split(/[\\/]/).pop()}(r)??"unknown_file"),!i?.type){const e=a[0]?.type;"string"==typeof e&&(i={...i,type:e})}return new t.File(a,n,i)}e.isUploadable=r=>(0,e.isFileLike)(r)||(0,e.isResponseLike)(r)||(0,t.isFsReadStream)(r),e.toFile=n;const s=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,o=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator];e.isMultipartBody=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag];e.maybeMultipartFormRequestOptions=async r=>{if(!i(r.body))return r;const n=await(0,e.createForm)(r.body);return(0,t.getMultipartRequestOptions)(n,r)};e.multipartFormRequestOptions=async r=>{const n=await(0,e.createForm)(r.body);return(0,t.getMultipartRequestOptions)(n,r)};e.createForm=async e=>{const r=new t.FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>a(r,e,t))),r};const i=t=>{if((0,e.isUploadable)(t))return!0;if(Array.isArray(t))return t.some(i);if(t&&"object"==typeof t)for(const e in t)if(i(t[e]))return!0;return!1},a=async(t,r,s)=>{if(void 0!==s){if(null==s)throw new TypeError(`Received null for "${r}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)t.append(r,String(s));else if((0,e.isUploadable)(s)){const e=await n(s);t.append(r,e)}else if(Array.isArray(s))await Promise.all(s.map(e=>a(t,r+"[]",e)));else{if("object"!=typeof s)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`);await Promise.all(Object.entries(s).map(([e,n])=>a(t,`${r}[${e}]`,n)))}}}}(oe);var ae={};Object.defineProperty(ae,"__esModule",{value:!0}),ae.CursorPage=ae.Page=void 0;const le=ie();class ce extends le.AbstractPage{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}ae.Page=ce;class ue extends le.AbstractPage{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}ae.CursorPage=ue;var de={},fe={},pe={},he={};Object.defineProperty(he,"__esModule",{value:!0}),he.APIResource=void 0;he.APIResource=class{constructor(e){this._client=e}};var me,ge,be={},ye={};function _e(){return me||(me=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ChatCompletionStoreMessagesPage=e.Messages=void 0;const t=he,r=ie(),n=ve();Object.defineProperty(e,"ChatCompletionStoreMessagesPage",{enumerable:!0,get:function(){return n.ChatCompletionStoreMessagesPage}});class s extends t.APIResource{list(e,t={},s){return(0,r.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,n.ChatCompletionStoreMessagesPage,{query:t,...s})}}e.Messages=s}(ye)),ye}function ve(){if(ge)return be;ge=1;var t=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&t(n,e,s);return r(n,e),n};Object.defineProperty(be,"__esModule",{value:!0}),be.ChatCompletionStoreMessagesPage=be.ChatCompletionsPage=be.Completions=void 0;const s=he,o=ie(),i=n(_e()),a=_e(),l=ae;class c extends s.APIResource{constructor(){super(...arguments),this.messages=new i.Messages(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return(0,o.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/chat/completions",u,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}}be.Completions=c;class u extends l.CursorPage{}be.ChatCompletionsPage=u;class d extends l.CursorPage{}return be.ChatCompletionStoreMessagesPage=d,c.ChatCompletionsPage=u,c.Messages=a.Messages,be}var we=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Pe=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Oe=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&we(t,e,r);return Pe(t,e),t};Object.defineProperty(pe,"__esModule",{value:!0}),pe.Chat=void 0;const Ae=he,je=Oe(ve()),Re=ve();class Ee extends Ae.APIResource{constructor(){super(...arguments),this.completions=new je.Completions(this._client)}}pe.Chat=Ee,Ee.Completions=Re.Completions,Ee.ChatCompletionsPage=Re.ChatCompletionsPage;var Ie={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Messages=e.Completions=e.ChatCompletionsPage=e.ChatCompletionStoreMessagesPage=void 0;var t=ve();Object.defineProperty(e,"ChatCompletionStoreMessagesPage",{enumerable:!0,get:function(){return t.ChatCompletionStoreMessagesPage}}),Object.defineProperty(e,"ChatCompletionsPage",{enumerable:!0,get:function(){return t.ChatCompletionsPage}}),Object.defineProperty(e,"Completions",{enumerable:!0,get:function(){return t.Completions}});var r=_e();Object.defineProperty(e,"Messages",{enumerable:!0,get:function(){return r.Messages}})}(Ie),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Completions=e.ChatCompletionsPage=e.ChatCompletionStoreMessagesPage=e.Chat=void 0;var t=pe;Object.defineProperty(e,"Chat",{enumerable:!0,get:function(){return t.Chat}});var r=Ie;Object.defineProperty(e,"ChatCompletionStoreMessagesPage",{enumerable:!0,get:function(){return r.ChatCompletionStoreMessagesPage}}),Object.defineProperty(e,"ChatCompletionsPage",{enumerable:!0,get:function(){return r.ChatCompletionsPage}}),Object.defineProperty(e,"Completions",{enumerable:!0,get:function(){return r.Completions}})}(fe);var Se={};Object.defineProperty(Se,"__esModule",{value:!0});var Ce={},xe={};Object.defineProperty(xe,"__esModule",{value:!0}),xe.Speech=void 0;const Me=he;class Fe extends Me.APIResource{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}xe.Speech=Fe;var ke={},Te=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),$e=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Be=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Te(t,e,r);return $e(t,e),t};Object.defineProperty(ke,"__esModule",{value:!0}),ke.Transcriptions=void 0;const De=he,qe=Be(ie());class Ne extends De.APIResource{create(e,t){return this._client.post("/audio/transcriptions",qe.multipartFormRequestOptions({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}ke.Transcriptions=Ne;var Le={},Ue=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Ve=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),We=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Ue(t,e,r);return Ve(t,e),t};Object.defineProperty(Le,"__esModule",{value:!0}),Le.Translations=void 0;const Je=he,He=We(ie());class Xe extends Je.APIResource{create(e,t){return this._client.post("/audio/translations",He.multipartFormRequestOptions({body:e,...t,__metadata:{model:e.model}}))}}Le.Translations=Xe;var ze=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Ke=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Ge=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&ze(t,e,r);return Ke(t,e),t};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.Audio=void 0;const Qe=he,Ye=Ge(xe),Ze=xe,et=Ge(ke),tt=ke,rt=Ge(Le),nt=Le;class st extends Qe.APIResource{constructor(){super(...arguments),this.transcriptions=new et.Transcriptions(this._client),this.translations=new rt.Translations(this._client),this.speech=new Ye.Speech(this._client)}}Ce.Audio=st,st.Transcriptions=tt.Transcriptions,st.Translations=nt.Translations,st.Speech=Ze.Speech;var ot={};Object.defineProperty(ot,"__esModule",{value:!0}),ot.BatchesPage=ot.Batches=void 0;const it=he,at=ie(),lt=ae;class ct extends it.APIResource{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return(0,at.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/batches",ut,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}ot.Batches=ct;class ut extends lt.CursorPage{}ot.BatchesPage=ut,ct.BatchesPage=ut;var dt,ft,pt,ht,mt,gt,bt,yt,_t,vt,wt,Pt,Ot,At={},jt={},Rt={},Et={},It=e&&e.__classPrivateFieldSet||function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},St=e&&e.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(Et,"__esModule",{value:!0}),Et.EventStream=void 0;const Ct=Q();Et.EventStream=class{constructor(){dt.add(this),this.controller=new AbortController,ft.set(this,void 0),pt.set(this,()=>{}),ht.set(this,()=>{}),mt.set(this,void 0),gt.set(this,()=>{}),bt.set(this,()=>{}),yt.set(this,{}),_t.set(this,!1),vt.set(this,!1),wt.set(this,!1),Pt.set(this,!1),It(this,ft,new Promise((e,t)=>{It(this,pt,e,"f"),It(this,ht,t,"f")}),"f"),It(this,mt,new Promise((e,t)=>{It(this,gt,e,"f"),It(this,bt,t,"f")}),"f"),St(this,ft,"f").catch(()=>{}),St(this,mt,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},St(this,dt,"m",Ot).bind(this))},0)}_connected(){this.ended||(St(this,pt,"f").call(this),this._emit("connect"))}get ended(){return St(this,_t,"f")}get errored(){return St(this,vt,"f")}get aborted(){return St(this,wt,"f")}abort(){this.controller.abort()}
/**
     * Adds the listener function to the end of the listeners array for the event.
     * No checks are made to see if the listener has already been added. Multiple calls passing
     * the same combination of event and listener will result in the listener being added, and
     * called, multiple times.
     * @returns this ChatCompletionStream, so that calls can be chained
     */on(e,t){return(St(this,yt,"f")[e]||(St(this,yt,"f")[e]=[])).push({listener:t}),this}
/**
     * Removes the specified listener from the listener array for the event.
     * off() will remove, at most, one instance of a listener from the listener array. If any single
     * listener has been added multiple times to the listener array for the specified event, then
     * off() must be called multiple times to remove each instance.
     * @returns this ChatCompletionStream, so that calls can be chained
     */off(e,t){const r=St(this,yt,"f")[e];if(!r)return this;const n=r.findIndex(e=>e.listener===t);return n>=0&&r.splice(n,1),this}
/**
     * Adds a one-time listener function for the event. The next time the event is triggered,
     * this listener is removed and then invoked.
     * @returns this ChatCompletionStream, so that calls can be chained
     */once(e,t){return(St(this,yt,"f")[e]||(St(this,yt,"f")[e]=[])).push({listener:t,once:!0}),this}
/**
     * This is similar to `.once()`, but returns a Promise that resolves the next time
     * the event is triggered, instead of calling a listener callback.
     * @returns a Promise that resolves the next time given event is triggered,
     * or rejects if an error is emitted.  (If you request the 'error' event,
     * returns a promise that resolves with the error).
     *
     * Example:
     *
     *   const message = await stream.emitted('message') // rejects if the stream errors
     */emitted(e){return new Promise((t,r)=>{It(this,Pt,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){It(this,Pt,!0,"f"),await St(this,mt,"f")}_emit(e,...t){if(St(this,_t,"f"))return;"end"===e&&(It(this,_t,!0,"f"),St(this,gt,"f").call(this));const r=St(this,yt,"f")[e];if(r&&(St(this,yt,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){const e=t[0];return St(this,Pt,"f")||r?.length||Promise.reject(e),St(this,ht,"f").call(this,e),St(this,bt,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];St(this,Pt,"f")||r?.length||Promise.reject(e),St(this,ht,"f").call(this,e),St(this,bt,"f").call(this,e),this._emit("end")}}_emitFinal(){}},ft=new WeakMap,pt=new WeakMap,ht=new WeakMap,mt=new WeakMap,gt=new WeakMap,bt=new WeakMap,yt=new WeakMap,_t=new WeakMap,vt=new WeakMap,wt=new WeakMap,Pt=new WeakMap,dt=new WeakSet,Ot=function(e){if(It(this,vt,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new Ct.APIUserAbortError),e instanceof Ct.APIUserAbortError)return It(this,wt,!0,"f"),this._emit("abort",e);if(e instanceof Ct.OpenAIError)return this._emit("error",e);if(e instanceof Error){const t=new Ct.OpenAIError(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Ct.OpenAIError(String(e)))};var xt,Mt,Ft,kt,Tt,$t,Bt,Dt,qt,Nt,Lt,Ut,Vt,Wt,Jt,Ht,Xt,zt,Kt,Gt,Qt,Yt,Zt=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),er=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),tr=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Zt(t,e,r);return er(t,e),t},rr=e&&e.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},nr=e&&e.__classPrivateFieldSet||function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r};Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.AssistantStream=void 0;const sr=tr(ie()),or=ne(),ir=Q(),ar=Et;class lr extends ar.EventStream{constructor(){super(...arguments),xt.add(this),Mt.set(this,[]),Ft.set(this,{}),kt.set(this,{}),Tt.set(this,void 0),$t.set(this,void 0),Bt.set(this,void 0),Dt.set(this,void 0),qt.set(this,void 0),Nt.set(this,void 0),Lt.set(this,void 0),Ut.set(this,void 0),Vt.set(this,void 0)}[(Mt=new WeakMap,Ft=new WeakMap,kt=new WeakMap,Tt=new WeakMap,$t=new WeakMap,Bt=new WeakMap,Dt=new WeakMap,qt=new WeakMap,Nt=new WeakMap,Lt=new WeakMap,Ut=new WeakMap,Vt=new WeakMap,xt=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",r=>{const n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{r=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{r=!0;for(const r of t)r.reject(e);t.length=0}),this.on("error",e=>{r=!0;for(const r of t)r.reject(e);t.length=0}),{next:async()=>{if(!e.length)return r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new lr;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){const r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const n=or.Stream.fromReadableStream(e,this.controller);for await(const e of n)rr(this,xt,"m",Wt).call(this,e);if(n.controller.signal?.aborted)throw new ir.APIUserAbortError;return this._addRun(rr(this,xt,"m",Jt).call(this))}toReadableStream(){return new or.Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,n,s){const o=new lr;return o._run(()=>o._runToolAssistantStream(e,t,r,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(e,t,r,n,s){const o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},a=await e.submitToolOutputs(t,r,i,{...s,signal:this.controller.signal});this._connected();for await(const e of a)rr(this,xt,"m",Wt).call(this,e);if(a.controller.signal?.aborted)throw new ir.APIUserAbortError;return this._addRun(rr(this,xt,"m",Jt).call(this))}static createThreadAssistantStream(e,t,r){const n=new lr;return n._run(()=>n._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,r,n){const s=new lr;return s._run(()=>s._runAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return rr(this,Lt,"f")}currentRun(){return rr(this,Ut,"f")}currentMessageSnapshot(){return rr(this,Tt,"f")}currentRunStepSnapshot(){return rr(this,Vt,"f")}async finalRunSteps(){return await this.done(),Object.values(rr(this,Ft,"f"))}async finalMessages(){return await this.done(),Object.values(rr(this,kt,"f"))}async finalRun(){if(await this.done(),!rr(this,$t,"f"))throw Error("Final run was not received.");return rr(this,$t,"f")}async _createThreadAssistantStream(e,t,r){const n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));const s={...t,stream:!0},o=await e.createAndRun(s,{...r,signal:this.controller.signal});this._connected();for await(const e of o)rr(this,xt,"m",Wt).call(this,e);if(o.controller.signal?.aborted)throw new ir.APIUserAbortError;return this._addRun(rr(this,xt,"m",Jt).call(this))}async _createAssistantStream(e,t,r,n){const s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},i=await e.create(t,o,{...n,signal:this.controller.signal});this._connected();for await(const e of i)rr(this,xt,"m",Wt).call(this,e);if(i.controller.signal?.aborted)throw new ir.APIUserAbortError;return this._addRun(rr(this,xt,"m",Jt).call(this))}static accumulateDelta(e,t){for(const[r,n]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=n;continue}let t=e[r];if(null!=t)if("index"!==r&&"type"!==r){if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else{if(!sr.isObj(t)||!sr.isObj(n)){if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(const e of n){if(!sr.isObj(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const r=e.index;if(null==r)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof r)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${r}`);const n=t[r];null==n?t.push(e):t[r]=this.accumulateDelta(n,e)}continue}throw Error(`Unhandled record type: ${r}, deltaValue: ${n}, accValue: ${t}`)}t=this.accumulateDelta(t,n)}e[r]=t}else e[r]=n;else e[r]=n}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,n){return await this._createAssistantStream(t,e,r,n)}async _runToolAssistantStream(e,t,r,n,s){return await this._createToolAssistantStream(r,e,t,n,s)}}Rt.AssistantStream=lr,Wt=function(e){if(!this.ended)switch(nr(this,Lt,e,"f"),rr(this,xt,"m",zt).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":rr(this,xt,"m",Yt).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":rr(this,xt,"m",Xt).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":rr(this,xt,"m",Ht).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Jt=function(){if(this.ended)throw new ir.OpenAIError("stream has ended, this shouldn't happen");if(!rr(this,$t,"f"))throw Error("Final run has not been received");return rr(this,$t,"f")},Ht=function(e){const[t,r]=rr(this,xt,"m",Gt).call(this,e,rr(this,Tt,"f"));nr(this,Tt,t,"f"),rr(this,kt,"f")[t.id]=t;for(const e of r){const r=t.content[e.index];"text"==r?.type&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if("text"==r.type&&r.text){let e=r.text,n=t.content[r.index];if(!n||"text"!=n.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,n.text)}if(r.index!=rr(this,Bt,"f")){if(rr(this,Dt,"f"))switch(rr(this,Dt,"f").type){case"text":this._emit("textDone",rr(this,Dt,"f").text,rr(this,Tt,"f"));break;case"image_file":this._emit("imageFileDone",rr(this,Dt,"f").image_file,rr(this,Tt,"f"))}nr(this,Bt,r.index,"f")}nr(this,Dt,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==rr(this,Bt,"f")){const t=e.data.content[rr(this,Bt,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,rr(this,Tt,"f"));break;case"text":this._emit("textDone",t.text,rr(this,Tt,"f"))}}rr(this,Tt,"f")&&this._emit("messageDone",e.data),nr(this,Tt,void 0,"f")}},Xt=function(e){const t=rr(this,xt,"m",Kt).call(this,e);switch(nr(this,Vt,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&"tool_calls"==r.step_details.type&&r.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of r.step_details.tool_calls)e.index==rr(this,qt,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(rr(this,Nt,"f")&&this._emit("toolCallDone",rr(this,Nt,"f")),nr(this,qt,e.index,"f"),nr(this,Nt,t.step_details.tool_calls[e.index],"f"),rr(this,Nt,"f")&&this._emit("toolCallCreated",rr(this,Nt,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":nr(this,Vt,void 0,"f");"tool_calls"==e.data.step_details.type&&rr(this,Nt,"f")&&(this._emit("toolCallDone",rr(this,Nt,"f")),nr(this,Nt,void 0,"f")),this._emit("runStepDone",e.data,t)}},zt=function(e){rr(this,Mt,"f").push(e),this._emit("event",e)},Kt=function(e){switch(e.event){case"thread.run.step.created":return rr(this,Ft,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=rr(this,Ft,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const n=lr.accumulateDelta(t,r.delta);rr(this,Ft,"f")[e.data.id]=n}return rr(this,Ft,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":rr(this,Ft,"f")[e.data.id]=e.data}if(rr(this,Ft,"f")[e.data.id])return rr(this,Ft,"f")[e.data.id];throw new Error("No snapshot available")},Gt=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(const e of n.delta.content)if(e.index in t.content){let r=t.content[e.index];t.content[e.index]=rr(this,xt,"m",Qt).call(this,e,r)}else t.content[e.index]=e,r.push(e);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Qt=function(e,t){return lr.accumulateDelta(t,e)},Yt=function(e){switch(nr(this,Ut,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":nr(this,$t,e.data,"f"),rr(this,Nt,"f")&&(this._emit("toolCallDone",rr(this,Nt,"f")),nr(this,Nt,void 0,"f"))}},Object.defineProperty(jt,"__esModule",{value:!0}),jt.AssistantsPage=jt.Assistants=void 0;const cr=he,ur=ie(),dr=ae;class fr extends cr.APIResource{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return(0,ur.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/assistants",pr,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}jt.Assistants=fr;class pr extends dr.CursorPage{}jt.AssistantsPage=pr,fr.AssistantsPage=pr;var hr={},mr={},gr={},br={},yr={};Object.defineProperty(yr,"__esModule",{value:!0}),yr.ParsingToolFunction=yr.ParsingFunction=yr.isRunnableFunctionWithParse=void 0,yr.isRunnableFunctionWithParse=function(e){return"function"==typeof e.parse};yr.ParsingFunction=class{constructor(e){this.function=e.function,this.parse=e.parse,this.parameters=e.parameters,this.description=e.description,this.name=e.name}};yr.ParsingToolFunction=class{constructor(e){this.type="function",this.function=e}};var _r={};Object.defineProperty(_r,"__esModule",{value:!0}),_r.isPresent=_r.isToolMessage=_r.isFunctionMessage=_r.isAssistantMessage=void 0;_r.isAssistantMessage=e=>"assistant"===e?.role;_r.isFunctionMessage=e=>"function"===e?.role;_r.isToolMessage=e=>"tool"===e?.role,_r.isPresent=function(e){return null!=e};var vr={};Object.defineProperty(vr,"__esModule",{value:!0}),vr.validateInputTools=vr.hasAutoParseableInput=vr.shouldParseToolCall=vr.parseChatCompletion=vr.maybeParseChatCompletion=vr.isAutoParsableTool=vr.makeParseableTool=vr.isAutoParsableResponseFormat=vr.makeParseableTextFormat=vr.makeParseableResponseFormat=void 0;const wr=Q();function Pr(e){return"auto-parseable-response-format"===e?.$brand}function Or(e){return"auto-parseable-tool"===e?.$brand}function Ar(e,t){const r=e.choices.map(e=>{if("length"===e.finish_reason)throw new wr.LengthFinishReasonError;if("content_filter"===e.finish_reason)throw new wr.ContentFilterFinishReasonError;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>function(e,t){const r=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:Or(r)?r.$parseRaw(t.function.arguments):r?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?jr(t,e.message.content):null}}});return{...e,choices:r}}function jr(e,t){if("json_schema"!==e.response_format?.type)return null;if("json_schema"===e.response_format?.type){if("$parseRaw"in e.response_format){return e.response_format.$parseRaw(t)}return JSON.parse(t)}return null}function Rr(e){return!!Pr(e.response_format)||(e.tools?.some(e=>Or(e)||"function"===e.type&&!0===e.function.strict)??!1)}vr.makeParseableResponseFormat=function(e,t){const r={...e};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),r},vr.makeParseableTextFormat=function(e,t){const r={...e};return Object.defineProperties(r,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:t,enumerable:!1}}),r},vr.isAutoParsableResponseFormat=Pr,vr.makeParseableTool=function(e,{parser:t,callback:r}){const n={...e};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:t,enumerable:!1},$callback:{value:r,enumerable:!1}}),n},vr.isAutoParsableTool=Or,vr.maybeParseChatCompletion=function(e,t){return t&&Rr(t)?Ar(e,t):{...e,choices:e.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}},vr.parseChatCompletion=Ar,vr.shouldParseToolCall=function(e,t){if(!e)return!1;const r=e.tools?.find(e=>e.function?.name===t.function.name);return Or(r)||r?.function.strict||!1},vr.hasAutoParseableInput=Rr,vr.validateInputTools=function(e){for(const t of e??[]){if("function"!==t.type)throw new wr.OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new wr.OpenAIError(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}};var Er,Ir,Sr,Cr,xr,Mr,Fr,kr,Tr=e&&e.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(br,"__esModule",{value:!0}),br.AbstractChatCompletionRunner=void 0;const $r=Q(),Br=yr,Dr=_r,qr=Et,Nr=vr,Lr=10;class Ur extends qr.EventStream{constructor(){super(...arguments),Er.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),((0,Dr.isFunctionMessage)(e)||(0,Dr.isToolMessage)(e))&&e.content)this._emit("functionCallResult",e.content);else if((0,Dr.isAssistantMessage)(e)&&e.function_call)this._emit("functionCall",e.function_call);else if((0,Dr.isAssistantMessage)(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}
/**
     * @returns a promise that resolves with the final ChatCompletion, or rejects
     * if an error occurred or the stream ended prematurely without producing a ChatCompletion.
     */async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new $r.OpenAIError("stream ended without producing a ChatCompletion");return e}
/**
     * @returns a promise that resolves with the content of the final ChatCompletionMessage, or rejects
     * if an error occurred or the stream ended prematurely without producing a ChatCompletionMessage.
     */async finalContent(){return await this.done(),Tr(this,Er,"m",Ir).call(this)}
/**
     * @returns a promise that resolves with the the final assistant ChatCompletionMessage response,
     * or rejects if an error occurred or the stream ended prematurely without producing a ChatCompletionMessage.
     */async finalMessage(){return await this.done(),Tr(this,Er,"m",Sr).call(this)}
/**
     * @returns a promise that resolves with the content of the final FunctionCall, or rejects
     * if an error occurred or the stream ended prematurely without producing a ChatCompletionMessage.
     */async finalFunctionCall(){return await this.done(),Tr(this,Er,"m",Cr).call(this)}async finalFunctionCallResult(){return await this.done(),Tr(this,Er,"m",xr).call(this)}async totalUsage(){return await this.done(),Tr(this,Er,"m",Mr).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Tr(this,Er,"m",Sr).call(this);t&&this._emit("finalMessage",t);const r=Tr(this,Er,"m",Ir).call(this);r&&this._emit("finalContent",r);const n=Tr(this,Er,"m",Cr).call(this);n&&this._emit("finalFunctionCall",n);const s=Tr(this,Er,"m",xr).call(this);null!=s&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",Tr(this,Er,"m",Mr).call(this))}async _createChatCompletion(e,t,r){const n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Tr(this,Er,"m",Fr).call(this,t);const s=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion((0,Nr.parseChatCompletion)(s,t))}async _runChatCompletion(e,t,r){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){const n="function",{function_call:s="auto",stream:o,...i}=t,a="string"!=typeof s&&s?.name,{maxChatCompletions:l=Lr}=r||{},c={};for(const e of t.functions)c[e.name||e.function.name]=e;const u=t.functions.map(e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description}));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...i,function_call:s,functions:u,messages:[...this.messages]},r),o=t.choices[0]?.message;if(!o)throw new $r.OpenAIError("missing message in ChatCompletion response");if(!o.function_call)return;const{name:l,arguments:d}=o.function_call,f=c[l];if(!f){const e=`Invalid function_call: ${JSON.stringify(l)}. Available options are: ${u.map(e=>JSON.stringify(e.name)).join(", ")}. Please try again`;this._addMessage({role:n,name:l,content:e});continue}if(a&&a!==l){const e=`Invalid function_call: ${JSON.stringify(l)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:n,name:l,content:e});continue}let p;try{p=(0,Br.isRunnableFunctionWithParse)(f)?await f.parse(d):d}catch(e){this._addMessage({role:n,name:l,content:e instanceof Error?e.message:String(e)});continue}const h=await f.function(p,this),m=Tr(this,Er,"m",kr).call(this,h);if(this._addMessage({role:n,name:l,content:m}),a)return}}async _runTools(e,t,r){const n="tool",{tool_choice:s="auto",stream:o,...i}=t,a="string"!=typeof s&&s?.function?.name,{maxChatCompletions:l=Lr}=r||{},c=t.tools.map(e=>{if((0,Nr.isAutoParsableTool)(e)){if(!e.$callback)throw new $r.OpenAIError("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(const e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);const d="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){const t=await this._createChatCompletion(e,{...i,tool_choice:s,tools:d,messages:[...this.messages]},r),o=t.choices[0]?.message;if(!o)throw new $r.OpenAIError("missing message in ChatCompletion response");if(!o.tool_calls?.length)return;for(const e of o.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:r,arguments:s}=e.function,o=u[r];if(!o){const e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}if(a&&a!==r){const e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}let i;try{i=(0,Br.isRunnableFunctionWithParse)(o)?await o.parse(s):s}catch(e){const r=e instanceof Error?e.message:String(e);this._addMessage({role:n,tool_call_id:t,content:r});continue}const l=await o.function(i,this),c=Tr(this,Er,"m",kr).call(this,l);if(this._addMessage({role:n,tool_call_id:t,content:c}),a)return}}}}br.AbstractChatCompletionRunner=Ur,Er=new WeakSet,Ir=function(){return Tr(this,Er,"m",Sr).call(this).content??null},Sr=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if((0,Dr.isAssistantMessage)(t)){const{function_call:e,...r}=t,n={...r,content:t.content??null,refusal:t.refusal??null};return e&&(n.function_call=e),n}}throw new $r.OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant")},Cr=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if((0,Dr.isAssistantMessage)(t)&&t?.function_call)return t.function_call;if((0,Dr.isAssistantMessage)(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},xr=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if((0,Dr.isFunctionMessage)(t)&&null!=t.content)return t.content;if((0,Dr.isToolMessage)(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},Mr=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Fr=function(e){if(null!=e.n&&e.n>1)throw new $r.OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},kr=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)},Object.defineProperty(gr,"__esModule",{value:!0}),gr.ChatCompletionRunner=void 0;const Vr=br,Wr=_r;class Jr extends Vr.AbstractChatCompletionRunner{static runFunctions(e,t,r){const n=new Jr,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,s)),n}static runTools(e,t,r){const n=new Jr,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,s)),n}_addMessage(e,t=!0){super._addMessage(e,t),(0,Wr.isAssistantMessage)(e)&&e.content&&this._emit("content",e.content)}}gr.ChatCompletionRunner=Jr;var Hr={},Xr={},zr={};Object.defineProperty(zr,"__esModule",{value:!0}),zr.MalformedJSON=zr.PartialJSON=zr.partialParse=void 0;const Kr=1,Gr=2,Qr=4,Yr=8,Zr=16,en=32,tn=64,rn=128,nn=256,sn=511;class on extends Error{}zr.PartialJSON=on;class an extends Error{}zr.MalformedJSON=an;const ln=(e,t)=>{const r=e.length;let n=0;const s=e=>{throw new on(`${e} at position ${n}`)},o=e=>{throw new an(`${e} at position ${n}`)},i=()=>(d(),n>=r&&s("Unexpected end of input"),'"'===e[n]?a():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||Zr&t&&r-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||en&t&&r-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||en&t&&r-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||rn&t&&r-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||nn&t&&1<r-n&&r-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||tn&t&&r-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u()),a=()=>{const i=n;let a=!1;for(n++;n<r&&('"'!==e[n]||a&&"\\"===e[n-1]);)a="\\"===e[n]&&!a,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(i,++n-Number(a)))}catch(e){o(String(e))}else if(Kr&t)try{return JSON.parse(e.substring(i,n-Number(a))+'"')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{n++,d();const o={};try{for(;"}"!==e[n];){if(d(),n>=r&&Yr&t)return o;const s=a();d(),n++;try{const e=i();Object.defineProperty(o,s,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(Yr&t)return o;throw e}d(),","===e[n]&&n++}}catch(e){if(Yr&t)return o;s("Expected '}' at end of object")}return n++,o},c=()=>{n++;const r=[];try{for(;"]"!==e[n];)r.push(i()),d(),","===e[n]&&n++}catch(e){if(Qr&t)return r;s("Expected ']' at end of array")}return n++,r},u=()=>{if(0===n){"-"===e&&Gr&t&&s("Not sure what '-' is");try{return JSON.parse(e)}catch(r){if(Gr&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}o(String(r))}}const i=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=r||Gr&t||s("Unterminated number literal");try{return JSON.parse(e.substring(i,n))}catch(r){"-"===e.substring(i,n)&&Gr&t&&s("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){o(String(e))}}},d=()=>{for(;n<r&&" \n\r\t".includes(e[n]);)n++};return i()};zr.partialParse=e=>
/**
 * Parse incomplete JSON
 * @param {string} jsonString Partial JSON to be parsed
 * @param {number} allowPartial Specify what types are allowed to be partial, see {@link Allow} for details
 * @returns The parsed JSON
 * @throws {PartialJSON} If the JSON is incomplete (related to the `allow` parameter)
 * @throws {MalformedJSON} If the JSON is malformed
 */
function(e,t=sn){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return ln(e.trim(),t)}(e,sn^Gr);var cn,un,dn,fn,pn,hn,mn,gn,bn,yn,_n,vn,wn=e&&e.__classPrivateFieldSet||function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},Pn=e&&e.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(Xr,"__esModule",{value:!0}),Xr.ChatCompletionStream=void 0;const On=Q(),An=br,jn=ne(),Rn=vr,En=zr;class In extends An.AbstractChatCompletionRunner{constructor(e){super(),cn.add(this),un.set(this,void 0),dn.set(this,void 0),fn.set(this,void 0),wn(this,un,e,"f"),wn(this,dn,[],"f")}get currentChatCompletionSnapshot(){return Pn(this,fn,"f")}static fromReadableStream(e){const t=new In(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const n=new In(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,r){super._createChatCompletion;const n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Pn(this,cn,"m",pn).call(this);const s=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const e of s)Pn(this,cn,"m",mn).call(this,e);if(s.controller.signal?.aborted)throw new On.APIUserAbortError;return this._addChatCompletion(Pn(this,cn,"m",yn).call(this))}async _fromReadableStream(e,t){const r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Pn(this,cn,"m",pn).call(this),this._connected();const n=jn.Stream.fromReadableStream(e,this.controller);let s;for await(const e of n)s&&s!==e.id&&this._addChatCompletion(Pn(this,cn,"m",yn).call(this)),Pn(this,cn,"m",mn).call(this,e),s=e.id;if(n.controller.signal?.aborted)throw new On.APIUserAbortError;return this._addChatCompletion(Pn(this,cn,"m",yn).call(this))}[(un=new WeakMap,dn=new WeakMap,fn=new WeakMap,cn=new WeakSet,pn=function(){this.ended||wn(this,fn,void 0,"f")},hn=function(e){let t=Pn(this,dn,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Pn(this,dn,"f")[e.index]=t,t)},mn=function(e){if(this.ended)return;const t=Pn(this,cn,"m",vn).call(this,e);this._emit("chunk",e,t);for(const r of e.choices){const e=t.choices[r.index];null!=r.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",r.delta.content,e.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=r.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:e.message.refusal}),null!=r.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=r.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const n=Pn(this,cn,"m",hn).call(this,e);e.finish_reason&&(Pn(this,cn,"m",bn).call(this,e),null!=n.current_tool_call_index&&Pn(this,cn,"m",gn).call(this,e,n.current_tool_call_index));for(const t of r.delta.tool_calls??[])n.current_tool_call_index!==t.index&&(Pn(this,cn,"m",bn).call(this,e),null!=n.current_tool_call_index&&Pn(this,cn,"m",gn).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(const t of r.delta.tool_calls??[]){const r=e.message.tool_calls?.[t.index];r?.type&&("function"===r?.type?this._emit("tool_calls.function.arguments.delta",{name:r.function?.name,index:t.index,arguments:r.function.arguments,parsed_arguments:r.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):Cn(r?.type))}}},gn=function(e,t){if(Pn(this,cn,"m",hn).call(this,e).done_tool_calls.has(t))return;const r=e.message.tool_calls?.[t];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if("function"===r.type){const e=Pn(this,un,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:t,arguments:r.function.arguments,parsed_arguments:(0,Rn.isAutoParsableTool)(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},bn=function(e){const t=Pn(this,cn,"m",hn).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const r=Pn(this,cn,"m",_n).call(this);this._emit("content.done",{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},yn=function(){if(this.ended)throw new On.OpenAIError("stream has ended, this shouldn't happen");const e=Pn(this,fn,"f");if(!e)throw new On.OpenAIError("request ended without sending any chunks");return wn(this,fn,void 0,"f"),wn(this,dn,[],"f"),function(e,t){const{id:r,choices:n,created:s,model:o,system_fingerprint:i,...a}=e,l={...a,id:r,choices:n.map(({message:t,finish_reason:r,index:n,logprobs:s,...o})=>{if(!r)throw new On.OpenAIError(`missing finish_reason for choice ${n}`);const{content:i=null,function_call:a,tool_calls:l,...c}=t,u=t.role;if(!u)throw new On.OpenAIError(`missing role for choice ${n}`);if(a){const{arguments:e,name:l}=a;if(null==e)throw new On.OpenAIError(`missing function_call.arguments for choice ${n}`);if(!l)throw new On.OpenAIError(`missing function_call.name for choice ${n}`);return{...o,message:{content:i,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:r,index:n,logprobs:s}}return l?{...o,index:n,finish_reason:r,logprobs:s,message:{...c,role:u,content:i,refusal:t.refusal??null,tool_calls:l.map((t,r)=>{const{function:s,type:o,id:i,...a}=t,{arguments:l,name:c,...u}=s||{};if(null==i)throw new On.OpenAIError(`missing choices[${n}].tool_calls[${r}].id\n${Sn(e)}`);if(null==o)throw new On.OpenAIError(`missing choices[${n}].tool_calls[${r}].type\n${Sn(e)}`);if(null==c)throw new On.OpenAIError(`missing choices[${n}].tool_calls[${r}].function.name\n${Sn(e)}`);if(null==l)throw new On.OpenAIError(`missing choices[${n}].tool_calls[${r}].function.arguments\n${Sn(e)}`);return{...a,id:i,type:o,function:{...u,name:c,arguments:l}}})}}:{...o,message:{...c,content:i,role:u,refusal:t.refusal??null},finish_reason:r,index:n,logprobs:s}}),created:s,model:o,object:"chat.completion",...i?{system_fingerprint:i}:{}};return(0,Rn.maybeParseChatCompletion)(l,t)}(e,Pn(this,un,"f"))},_n=function(){const e=Pn(this,un,"f")?.response_format;return(0,Rn.isAutoParsableResponseFormat)(e)?e:null},vn=function(e){var t,r,n,s;let o=Pn(this,fn,"f");const{choices:i,...a}=e;o?Object.assign(o,a):o=wn(this,fn,{...a,choices:[]},"f");for(const{delta:i,finish_reason:a,index:l,logprobs:c=null,...u}of e.choices){let e=o.choices[l];if(e||(e=o.choices[l]={finish_reason:a,index:l,message:{},logprobs:c,...u}),c)if(e.logprobs){const{content:n,refusal:s,...o}=c;Object.assign(e.logprobs,o),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),s&&((r=e.logprobs).refusal??(r.refusal=[]),e.logprobs.refusal.push(...s))}else e.logprobs=Object.assign({},c);if(a&&(e.finish_reason=a,Pn(this,un,"f")&&(0,Rn.hasAutoParseableInput)(Pn(this,un,"f")))){if("length"===a)throw new On.LengthFinishReasonError;if("content_filter"===a)throw new On.ContentFilterFinishReasonError}if(Object.assign(e,u),!i)continue;const{content:d,refusal:f,function_call:p,role:h,tool_calls:m,...g}=i;if(Object.assign(e.message,g),f&&(e.message.refusal=(e.message.refusal||"")+f),h&&(e.message.role=h),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),d&&(e.message.content=(e.message.content||"")+d,!e.message.refusal&&Pn(this,cn,"m",_n).call(this)&&(e.message.parsed=(0,En.partialParse)(e.message.content))),m){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:r,type:n,function:o,...i}of m){const a=(s=e.message.tool_calls)[t]??(s[t]={});Object.assign(a,i),r&&(a.id=r),n&&(a.type=n),o&&(a.function??(a.function={name:o.name??"",arguments:""})),o?.name&&(a.function.name=o.name),o?.arguments&&(a.function.arguments+=o.arguments,(0,Rn.shouldParseToolCall)(Pn(this,un,"f"),a)&&(a.function.parsed_arguments=(0,En.partialParse)(a.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",r=>{const n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{r=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{r=!0;for(const r of t)r.reject(e);t.length=0}),this.on("error",e=>{r=!0;for(const r of t)r.reject(e);t.length=0}),{next:async()=>{if(!e.length)return r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new jn.Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Sn(e){return JSON.stringify(e)}function Cn(e){}Xr.ChatCompletionStream=In,Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.ChatCompletionStreamingRunner=void 0;const xn=Xr;class Mn extends xn.ChatCompletionStream{static fromReadableStream(e){const t=new Mn(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const n=new Mn(null),s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,s)),n}static runTools(e,t,r){const n=new Mn(t),s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,s)),n}}Hr.ChatCompletionStreamingRunner=Mn,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Completions=e.ChatCompletionRunner=e.ChatCompletionStream=e.ParsingToolFunction=e.ParsingFunction=e.ChatCompletionStreamingRunner=void 0;const t=he,r=gr,n=Hr,s=Xr,o=vr;var i=Hr;Object.defineProperty(e,"ChatCompletionStreamingRunner",{enumerable:!0,get:function(){return i.ChatCompletionStreamingRunner}});var a=yr;Object.defineProperty(e,"ParsingFunction",{enumerable:!0,get:function(){return a.ParsingFunction}}),Object.defineProperty(e,"ParsingToolFunction",{enumerable:!0,get:function(){return a.ParsingToolFunction}});var l=Xr;Object.defineProperty(e,"ChatCompletionStream",{enumerable:!0,get:function(){return l.ChatCompletionStream}});var c=gr;Object.defineProperty(e,"ChatCompletionRunner",{enumerable:!0,get:function(){return c.ChatCompletionRunner}});class u extends t.APIResource{parse(e,t){return(0,o.validateInputTools)(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(t=>(0,o.parseChatCompletion)(t,e))}runFunctions(e,t){return e.stream?n.ChatCompletionStreamingRunner.runFunctions(this._client,e,t):r.ChatCompletionRunner.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?n.ChatCompletionStreamingRunner.runTools(this._client,e,t):r.ChatCompletionRunner.runTools(this._client,e,t)}stream(e,t){return s.ChatCompletionStream.createChatCompletion(this._client,e,t)}}e.Completions=u}(mr),function(t){var r=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&r(t,e,s);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Chat=void 0;const o=he,i=s(mr);class a extends o.APIResource{constructor(){super(...arguments),this.completions=new i.Completions(this._client)}}t.Chat=a,function(e){e.Completions=i.Completions}(a=t.Chat||(t.Chat={}))}(hr);var Fn={},kn={};Object.defineProperty(kn,"__esModule",{value:!0}),kn.Sessions=void 0;const Tn=he;class $n extends Tn.APIResource{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}kn.Sessions=$n;var Bn={};Object.defineProperty(Bn,"__esModule",{value:!0}),Bn.TranscriptionSessions=void 0;const Dn=he;class qn extends Dn.APIResource{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}Bn.TranscriptionSessions=qn;var Nn=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Ln=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Un=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Nn(t,e,r);return Ln(t,e),t};Object.defineProperty(Fn,"__esModule",{value:!0}),Fn.Realtime=void 0;const Vn=he,Wn=Un(kn),Jn=kn,Hn=Un(Bn),Xn=Bn;class zn extends Vn.APIResource{constructor(){super(...arguments),this.sessions=new Wn.Sessions(this._client),this.transcriptionSessions=new Hn.TranscriptionSessions(this._client)}}Fn.Realtime=zn,zn.Sessions=Jn.Sessions,zn.TranscriptionSessions=Xn.TranscriptionSessions;var Kn={},Gn={};Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.MessagesPage=Gn.Messages=void 0;const Qn=he,Yn=ie(),Zn=ae;class es extends Qn.APIResource{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},r){return(0,Yn.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,ts,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}Gn.Messages=es;class ts extends Zn.CursorPage{}Gn.MessagesPage=ts,es.MessagesPage=ts;var rs={},ns={};Object.defineProperty(ns,"__esModule",{value:!0}),ns.RunStepsPage=ns.Steps=void 0;const ss=he,os=ie(),is=ae;class as extends ss.APIResource{retrieve(e,t,r,n={},s){return(0,os.isRequestOptions)(n)?this.retrieve(e,t,r,{},n):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t,r={},n){return(0,os.isRequestOptions)(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,ls,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}ns.Steps=as;class ls extends is.CursorPage{}ns.RunStepsPage=ls,as.RunStepsPage=ls;var cs=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),us=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),ds=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&cs(t,e,r);return us(t,e),t};Object.defineProperty(rs,"__esModule",{value:!0}),rs.RunsPage=rs.Runs=void 0;const fs=he,ps=ie(),hs=Rt,ms=ie(),gs=ds(ns),bs=ns,ys=ae;class _s extends fs.APIResource{constructor(){super(...arguments),this.steps=new gs.Steps(this._client)}create(e,t,r){const{include:n,...s}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:n},body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},r){return(0,ps.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,vs,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){const n=await this.create(e,t,r);return await this.poll(e,n.id,r)}createAndStream(e,t,r){return hs.AssistantStream.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const n={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:s,response:o}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...n}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(r?.pollIntervalMs)e=r.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const r=parseInt(t);isNaN(r)||(e=r)}}await(0,ms.sleep)(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,r){return hs.AssistantStream.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,n){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,n){const s=await this.submitToolOutputs(e,t,r,n);return await this.poll(e,s.id,n)}submitToolOutputsStream(e,t,r,n){return hs.AssistantStream.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,n)}}rs.Runs=_s;class vs extends ys.CursorPage{}rs.RunsPage=vs,_s.RunsPage=vs,_s.Steps=bs.Steps,_s.RunStepsPage=bs.RunStepsPage;var ws=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Ps=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Os=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&ws(t,e,r);return Ps(t,e),t};Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.Threads=void 0;const As=he,js=ie(),Rs=Rt,Es=Os(Gn),Is=Gn,Ss=Os(rs),Cs=rs;class xs extends As.APIResource{constructor(){super(...arguments),this.runs=new Ss.Runs(this._client),this.messages=new Es.Messages(this._client)}create(e={},t){return(0,js.isRequestOptions)(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return Rs.AssistantStream.createThreadAssistantStream(e,this._client.beta.threads,t)}}Kn.Threads=xs,xs.Runs=Cs.Runs,xs.RunsPage=Cs.RunsPage,xs.Messages=Is.Messages,xs.MessagesPage=Is.MessagesPage;var Ms=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Fs=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),ks=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Ms(t,e,r);return Fs(t,e),t};Object.defineProperty(At,"__esModule",{value:!0}),At.Beta=void 0;const Ts=he,$s=ks(jt),Bs=ks(hr),Ds=jt,qs=ks(Fn),Ns=Fn,Ls=ks(Kn),Us=Kn;class Vs extends Ts.APIResource{constructor(){super(...arguments),this.realtime=new qs.Realtime(this._client),this.chat=new Bs.Chat(this._client),this.assistants=new $s.Assistants(this._client),this.threads=new Ls.Threads(this._client)}}At.Beta=Vs,Vs.Realtime=Ns.Realtime,Vs.Assistants=Ds.Assistants,Vs.AssistantsPage=Ds.AssistantsPage,Vs.Threads=Us.Threads;var Ws={};Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.Completions=void 0;const Js=he;class Hs extends Js.APIResource{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}Ws.Completions=Hs;var Xs={},zs=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Ks=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Gs=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&zs(t,e,r);return Ks(t,e),t};Object.defineProperty(Xs,"__esModule",{value:!0}),Xs.Embeddings=void 0;const Qs=he,Ys=Gs(ie());class Zs extends Qs.APIResource{create(e,t){const r=!!e.encoding_format;let n=r?e.encoding_format:"base64";r&&Ys.debug("Request","User defined encoding_format:",e.encoding_format);const s=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return r?s:(Ys.debug("response","Decoding base64 embeddings to float32 array"),s._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{const t=e.embedding;e.embedding=Ys.toFloat32Array(t)}),e)))}}Xs.Embeddings=Zs;var eo={},to={},ro={};Object.defineProperty(ro,"__esModule",{value:!0}),ro.OutputItemListResponsesPage=ro.OutputItems=void 0;const no=he,so=ie(),oo=ae;class io extends no.APIResource{retrieve(e,t,r,n){return this._client.get(`/evals/${e}/runs/${t}/output_items/${r}`,n)}list(e,t,r={},n){return(0,so.isRequestOptions)(r)?this.list(e,t,{},r):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,ao,{query:r,...n})}}ro.OutputItems=io;class ao extends oo.CursorPage{}ro.OutputItemListResponsesPage=ao,io.OutputItemListResponsesPage=ao;var lo=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),co=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),uo=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&lo(t,e,r);return co(t,e),t};Object.defineProperty(to,"__esModule",{value:!0}),to.RunListResponsesPage=to.Runs=void 0;const fo=he,po=ie(),ho=uo(ro),mo=ro,go=ae;class bo extends fo.APIResource{constructor(){super(...arguments),this.outputItems=new ho.OutputItems(this._client)}create(e,t,r){return this._client.post(`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){return this._client.get(`/evals/${e}/runs/${t}`,r)}list(e,t={},r){return(0,po.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,yo,{query:t,...r})}del(e,t,r){return this._client.delete(`/evals/${e}/runs/${t}`,r)}cancel(e,t,r){return this._client.post(`/evals/${e}/runs/${t}`,r)}}to.Runs=bo;class yo extends go.CursorPage{}to.RunListResponsesPage=yo,bo.RunListResponsesPage=yo,bo.OutputItems=mo.OutputItems,bo.OutputItemListResponsesPage=mo.OutputItemListResponsesPage;var _o=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),vo=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),wo=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&_o(t,e,r);return vo(t,e),t};Object.defineProperty(eo,"__esModule",{value:!0}),eo.EvalListResponsesPage=eo.Evals=void 0;const Po=he,Oo=ie(),Ao=wo(to),jo=to,Ro=ae;class Eo extends Po.APIResource{constructor(){super(...arguments),this.runs=new Ao.Runs(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,r){return this._client.post(`/evals/${e}`,{body:t,...r})}list(e={},t){return(0,Oo.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/evals",Io,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}eo.Evals=Eo;class Io extends Ro.CursorPage{}eo.EvalListResponsesPage=Io,Eo.EvalListResponsesPage=Io,Eo.Runs=jo.Runs,Eo.RunListResponsesPage=jo.RunListResponsesPage;var So={},Co=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),xo=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Mo=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Co(t,e,r);return xo(t,e),t};Object.defineProperty(So,"__esModule",{value:!0}),So.FileObjectsPage=So.Files=void 0;const Fo=he,ko=ie(),To=ie(),$o=Q(),Bo=Mo(ie()),Do=ae;class qo extends Fo.APIResource{create(e,t){return this._client.post("/files",Bo.multipartFormRequestOptions({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return(0,ko.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/files",No,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){const n=new Set(["processed","error","deleted"]),s=Date.now();let o=await this.retrieve(e);for(;!o.status||!n.has(o.status);)if(await(0,To.sleep)(t),o=await this.retrieve(e),Date.now()-s>r)throw new $o.APIConnectionTimeoutError({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return o}}So.Files=qo;class No extends Do.CursorPage{}So.FileObjectsPage=No,qo.FileObjectsPage=No;var Lo={},Uo={};Object.defineProperty(Uo,"__esModule",{value:!0}),Uo.Methods=void 0;const Vo=he;class Wo extends Vo.APIResource{}Uo.Methods=Wo;var Jo={},Ho={};Object.defineProperty(Ho,"__esModule",{value:!0}),Ho.Graders=void 0;const Xo=he;class zo extends Xo.APIResource{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}Ho.Graders=zo;var Ko=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Go=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Qo=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Ko(t,e,r);return Go(t,e),t};Object.defineProperty(Jo,"__esModule",{value:!0}),Jo.Alpha=void 0;const Yo=he,Zo=Qo(Ho),ei=Ho;class ti extends Yo.APIResource{constructor(){super(...arguments),this.graders=new Zo.Graders(this._client)}}Jo.Alpha=ti,ti.Graders=ei.Graders;var ri={},ni={};Object.defineProperty(ni,"__esModule",{value:!0}),ni.PermissionCreateResponsesPage=ni.Permissions=void 0;const si=he,oi=ie(),ii=ae;class ai extends si.APIResource{create(e,t,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,li,{body:t,method:"post",...r})}retrieve(e,t={},r){return(0,oi.isRequestOptions)(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}del(e,t,r){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,r)}}ni.Permissions=ai;class li extends ii.Page{}ni.PermissionCreateResponsesPage=li,ai.PermissionCreateResponsesPage=li;var ci=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),ui=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),di=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&ci(t,e,r);return ui(t,e),t};Object.defineProperty(ri,"__esModule",{value:!0}),ri.Checkpoints=void 0;const fi=he,pi=di(ni),hi=ni;class mi extends fi.APIResource{constructor(){super(...arguments),this.permissions=new pi.Permissions(this._client)}}ri.Checkpoints=mi,mi.Permissions=hi.Permissions,mi.PermissionCreateResponsesPage=hi.PermissionCreateResponsesPage;var gi={},bi={};Object.defineProperty(bi,"__esModule",{value:!0}),bi.FineTuningJobCheckpointsPage=bi.Checkpoints=void 0;const yi=he,_i=ie(),vi=ae;class wi extends yi.APIResource{list(e,t={},r){return(0,_i.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Pi,{query:t,...r})}}bi.Checkpoints=wi;class Pi extends vi.CursorPage{}bi.FineTuningJobCheckpointsPage=Pi,wi.FineTuningJobCheckpointsPage=Pi;var Oi=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Ai=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),ji=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Oi(t,e,r);return Ai(t,e),t};Object.defineProperty(gi,"__esModule",{value:!0}),gi.FineTuningJobEventsPage=gi.FineTuningJobsPage=gi.Jobs=void 0;const Ri=he,Ei=ie(),Ii=ji(bi),Si=bi,Ci=ae;class xi extends Ri.APIResource{constructor(){super(...arguments),this.checkpoints=new Ii.Checkpoints(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return(0,Ei.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Mi,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return(0,Ei.isRequestOptions)(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Fi,{query:t,...r})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}gi.Jobs=xi;class Mi extends Ci.CursorPage{}gi.FineTuningJobsPage=Mi;class Fi extends Ci.CursorPage{}gi.FineTuningJobEventsPage=Fi,xi.FineTuningJobsPage=Mi,xi.FineTuningJobEventsPage=Fi,xi.Checkpoints=Si.Checkpoints,xi.FineTuningJobCheckpointsPage=Si.FineTuningJobCheckpointsPage;var ki=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Ti=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),$i=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&ki(t,e,r);return Ti(t,e),t};Object.defineProperty(Lo,"__esModule",{value:!0}),Lo.FineTuning=void 0;const Bi=he,Di=$i(Uo),qi=Uo,Ni=$i(Jo),Li=Jo,Ui=$i(ri),Vi=ri,Wi=$i(gi),Ji=gi;class Hi extends Bi.APIResource{constructor(){super(...arguments),this.methods=new Di.Methods(this._client),this.jobs=new Wi.Jobs(this._client),this.checkpoints=new Ui.Checkpoints(this._client),this.alpha=new Ni.Alpha(this._client)}}Lo.FineTuning=Hi,Hi.Methods=qi.Methods,Hi.Jobs=Ji.Jobs,Hi.FineTuningJobsPage=Ji.FineTuningJobsPage,Hi.FineTuningJobEventsPage=Ji.FineTuningJobEventsPage,Hi.Checkpoints=Vi.Checkpoints,Hi.Alpha=Li.Alpha;var Xi={},zi={};Object.defineProperty(zi,"__esModule",{value:!0}),zi.GraderModels=void 0;const Ki=he;class Gi extends Ki.APIResource{}zi.GraderModels=Gi;var Qi=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Yi=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Zi=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Qi(t,e,r);return Yi(t,e),t};Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.Graders=void 0;const ea=he,ta=Zi(zi),ra=zi;class na extends ea.APIResource{constructor(){super(...arguments),this.graderModels=new ta.GraderModels(this._client)}}Xi.Graders=na,na.GraderModels=ra.GraderModels;var sa={},oa=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),ia=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),aa=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&oa(t,e,r);return ia(t,e),t};Object.defineProperty(sa,"__esModule",{value:!0}),sa.Images=void 0;const la=he,ca=aa(ie());class ua extends la.APIResource{createVariation(e,t){return this._client.post("/images/variations",ca.multipartFormRequestOptions({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",ca.multipartFormRequestOptions({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}sa.Images=ua;var da={};Object.defineProperty(da,"__esModule",{value:!0}),da.ModelsPage=da.Models=void 0;const fa=he,pa=ae;class ha extends fa.APIResource{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",ma,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}da.Models=ha;class ma extends pa.Page{}da.ModelsPage=ma,ha.ModelsPage=ma;var ga={};Object.defineProperty(ga,"__esModule",{value:!0}),ga.Moderations=void 0;const ba=he;class ya extends ba.APIResource{create(e,t){return this._client.post("/moderations",{body:e,...t})}}ga.Moderations=ya;var _a={},va={};Object.defineProperty(va,"__esModule",{value:!0}),va.addOutputText=va.validateInputTools=va.shouldParseToolCall=va.isAutoParsableTool=va.makeParseableResponseTool=va.hasAutoParseableInput=va.parseResponse=va.maybeParseResponse=void 0;const wa=Q(),Pa=vr;function Oa(e,t){const r=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:Ia(t,e)};if("message"===e.type){const r=e.content.map(e=>"output_text"===e.type?{...e,parsed:Aa(t,e.text)}:e);return{...e,content:r}}return e}),n=Object.assign({},e,{output:r});return Object.getOwnPropertyDescriptor(e,"output_text")||Sa(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const e of n.output)if("message"===e.type)for(const t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed;return null}}),n}function Aa(e,t){if("json_schema"!==e.text?.format?.type)return null;if("$parseRaw"in e.text?.format){const r=e.text?.format;return r.$parseRaw(t)}return JSON.parse(t)}function ja(e){return!!(0,Pa.isAutoParsableResponseFormat)(e.text?.format)}function Ra(e){return"auto-parseable-tool"===e?.$brand}function Ea(e,t){return e.find(e=>"function"===e.type&&e.name===t)}function Ia(e,t){const r=Ea(e.tools??[],t.name);return{...t,...t,parsed_arguments:Ra(r)?r.$parseRaw(t.arguments):r?.strict?JSON.parse(t.arguments):null}}function Sa(e){const t=[];for(const r of e.output)if("message"===r.type)for(const e of r.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}va.maybeParseResponse=function(e,t){return t&&ja(t)?Oa(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}},va.parseResponse=Oa,va.hasAutoParseableInput=ja,va.makeParseableResponseTool=function(e,{parser:t,callback:r}){const n={...e};return Object.defineProperties(n,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:t,enumerable:!1},$callback:{value:r,enumerable:!1}}),n},va.isAutoParsableTool=Ra,va.shouldParseToolCall=function(e,t){if(!e)return!1;const r=Ea(e.tools??[],t.name);return Ra(r)||r?.strict||!1},va.validateInputTools=function(e){for(const t of e??[]){if("function"!==t.type)throw new wa.OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new wa.OpenAIError(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}},va.addOutputText=Sa;var Ca,xa={};function Ma(){return Ca||(Ca=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ResponseItemsPage=e.InputItems=void 0;const t=he,r=ie(),n=Ka();Object.defineProperty(e,"ResponseItemsPage",{enumerable:!0,get:function(){return n.ResponseItemsPage}});class s extends t.APIResource{list(e,t={},s){return(0,r.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,n.ResponseItemsPage,{query:t,...s})}}e.InputItems=s}(xa)),xa}var Fa,ka,Ta,$a,Ba,Da,qa,Na,La={},Ua=e&&e.__classPrivateFieldSet||function(e,t,r,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},Va=e&&e.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(La,"__esModule",{value:!0}),La.ResponseStream=void 0;const Wa=Q(),Ja=Et,Ha=va;class Xa extends Ja.EventStream{constructor(e){super(),Fa.add(this),ka.set(this,void 0),Ta.set(this,void 0),$a.set(this,void 0),Ua(this,ka,e,"f")}static createResponse(e,t,r){const n=new Xa(t);return n._run(()=>n._createResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createResponse(e,t,r){const n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),Va(this,Fa,"m",Ba).call(this);const s=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const e of s)Va(this,Fa,"m",Da).call(this,e);if(s.controller.signal?.aborted)throw new Wa.APIUserAbortError;return Va(this,Fa,"m",qa).call(this)}[(ka=new WeakMap,Ta=new WeakMap,$a=new WeakMap,Fa=new WeakSet,Ba=function(){this.ended||Ua(this,Ta,void 0,"f")},Da=function(e){if(this.ended)return;const t=Va(this,Fa,"m",Na).call(this,e);switch(this._emit("event",e),e.type){case"response.output_text.delta":{const r=t.output[e.output_index];if(!r)throw new Wa.OpenAIError(`missing output at index ${e.output_index}`);if("message"===r.type){const t=r.content[e.content_index];if(!t)throw new Wa.OpenAIError(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new Wa.OpenAIError(`expected content to be 'output_text', got ${t.type}`);this._emit("response.output_text.delta",{...e,snapshot:t.text})}break}case"response.function_call_arguments.delta":{const r=t.output[e.output_index];if(!r)throw new Wa.OpenAIError(`missing output at index ${e.output_index}`);"function_call"===r.type&&this._emit("response.function_call_arguments.delta",{...e,snapshot:r.arguments});break}default:this._emit(e.type,e)}},qa=function(){if(this.ended)throw new Wa.OpenAIError("stream has ended, this shouldn't happen");const e=Va(this,Ta,"f");if(!e)throw new Wa.OpenAIError("request ended without sending any events");Ua(this,Ta,void 0,"f");const t=function(e,t){return(0,Ha.maybeParseResponse)(e,t)}(e,Va(this,ka,"f"));return Ua(this,$a,t,"f"),t},Na=function(e){let t=Va(this,Ta,"f");if(!t){if("response.created"!==e.type)throw new Wa.OpenAIError(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return t=Ua(this,Ta,e.response,"f"),t}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{const r=t.output[e.output_index];if(!r)throw new Wa.OpenAIError(`missing output at index ${e.output_index}`);"message"===r.type&&r.content.push(e.part);break}case"response.output_text.delta":{const r=t.output[e.output_index];if(!r)throw new Wa.OpenAIError(`missing output at index ${e.output_index}`);if("message"===r.type){const t=r.content[e.content_index];if(!t)throw new Wa.OpenAIError(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new Wa.OpenAIError(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{const r=t.output[e.output_index];if(!r)throw new Wa.OpenAIError(`missing output at index ${e.output_index}`);"function_call"===r.type&&(r.arguments+=e.delta);break}case"response.completed":Ua(this,Ta,e.response,"f")}return t},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",r=>{const n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{r=!0;for(const e of t)e.resolve(void 0);t.length=0}),this.on("abort",e=>{r=!0;for(const r of t)r.reject(e);t.length=0}),this.on("error",e=>{r=!0;for(const r of t)r.reject(e);t.length=0}),{next:async()=>{if(!e.length)return r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});return{value:e.shift(),done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}
/**
     * @returns a promise that resolves with the final Response, or rejects
     * if an error occurred or the stream ended prematurely without producing a REsponse.
     */async finalResponse(){await this.done();const e=Va(this,$a,"f");if(!e)throw new Wa.OpenAIError("stream ended without producing a ChatCompletion");return e}}var za;function Ka(){if(za)return _a;za=1;var t=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var s in e)"default"!==s&&Object.prototype.hasOwnProperty.call(e,s)&&t(n,e,s);return r(n,e),n};Object.defineProperty(_a,"__esModule",{value:!0}),_a.ResponseItemsPage=_a.Responses=void 0;const s=va,o=ie(),i=he,a=n(Ma()),l=Ma(),c=La,u=ae;class d extends i.APIResource{constructor(){super(...arguments),this.inputItems=new a.InputItems(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&(0,s.addOutputText)(e),e))}retrieve(e,t={},r){return(0,o.isRequestOptions)(t)?this.retrieve(e,{},t):this._client.get(`/responses/${e}`,{query:t,...r})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>(0,s.parseResponse)(t,e))}stream(e,t){return c.ResponseStream.createResponse(this._client,e,t)}}_a.Responses=d;class f extends u.CursorPage{}return _a.ResponseItemsPage=f,d.InputItems=l.InputItems,_a}La.ResponseStream=Xa;var Ga={},Qa={},Ya=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Za=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),el=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Ya(t,e,r);return Za(t,e),t};Object.defineProperty(Qa,"__esModule",{value:!0}),Qa.Parts=void 0;const tl=he,rl=el(ie());class nl extends tl.APIResource{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,rl.multipartFormRequestOptions({body:t,...r}))}}Qa.Parts=nl;var sl=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),ol=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),il=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&sl(t,e,r);return ol(t,e),t};Object.defineProperty(Ga,"__esModule",{value:!0}),Ga.Uploads=void 0;const al=he,ll=il(Qa),cl=Qa;class ul extends al.APIResource{constructor(){super(...arguments),this.parts=new ll.Parts(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}Ga.Uploads=ul,ul.Parts=cl.Parts;var dl={},fl={},pl={};Object.defineProperty(pl,"__esModule",{value:!0}),pl.allSettledWithThrow=void 0;pl.allSettledWithThrow=async e=>{const t=await Promise.allSettled(e),r=t.filter(e=>"rejected"===e.status);if(r.length){for(const e of r)console.error(e.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}const n=[];for(const e of t)"fulfilled"===e.status&&n.push(e.value);return n};var hl={};Object.defineProperty(hl,"__esModule",{value:!0}),hl.FileContentResponsesPage=hl.VectorStoreFilesPage=hl.Files=void 0;const ml=he,gl=ie(),bl=ae;class yl extends ml.APIResource{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,n){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},r){return(0,gl.isRequestOptions)(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,_l,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){const n=await this.create(e,t,r);return await this.poll(e,n.id,r)}async poll(e,t,r){const n={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const s=await this.retrieve(e,t,{...r,headers:n}).withResponse(),o=s.data;switch(o.status){case"in_progress":let e=5e3;if(r?.pollIntervalMs)e=r.pollIntervalMs;else{const t=s.response.headers.get("openai-poll-after-ms");if(t){const r=parseInt(t);isNaN(r)||(e=r)}}await(0,gl.sleep)(e);break;case"failed":case"completed":return o}}}async upload(e,t,r){const n=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:n.id},r)}async uploadAndPoll(e,t,r){const n=await this.upload(e,t,r);return await this.poll(e,n.id,r)}content(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,vl,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}hl.Files=yl;class _l extends bl.CursorPage{}hl.VectorStoreFilesPage=_l;class vl extends bl.Page{}hl.FileContentResponsesPage=vl,yl.VectorStoreFilesPage=_l,yl.FileContentResponsesPage=vl,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.VectorStoreFilesPage=e.FileBatches=void 0;const t=he,r=ie(),n=ie(),s=pl,o=hl;Object.defineProperty(e,"VectorStoreFilesPage",{enumerable:!0,get:function(){return o.VectorStoreFilesPage}});class i extends t.APIResource{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){const n=await this.create(e,t);return await this.poll(e,n.id,r)}listFiles(e,t,n={},s){return(0,r.isRequestOptions)(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,o.VectorStoreFilesPage,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async poll(e,t,r){const s={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:o,response:i}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(o.status){case"in_progress":let e=5e3;if(r?.pollIntervalMs)e=r.pollIntervalMs;else{const t=i.headers.get("openai-poll-after-ms");if(t){const r=parseInt(t);isNaN(r)||(e=r)}}await(0,n.sleep)(e);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},n){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=n?.maxConcurrency??5,i=Math.min(o,t.length),a=this._client,l=t.values(),c=[...r];const u=Array(i).fill(l).map(async function(e){for(let t of e){const e=await a.files.create({file:t,purpose:"assistants"},n);c.push(e.id)}});return await(0,s.allSettledWithThrow)(u),await this.createAndPoll(e,{file_ids:c})}}e.FileBatches=i}(fl);var wl=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),Pl=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Ol=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&wl(t,e,r);return Pl(t,e),t};Object.defineProperty(dl,"__esModule",{value:!0}),dl.VectorStoreSearchResponsesPage=dl.VectorStoresPage=dl.VectorStores=void 0;const Al=he,jl=ie(),Rl=Ol(fl),El=fl,Il=Ol(hl),Sl=hl,Cl=ae;class xl extends Al.APIResource{constructor(){super(...arguments),this.files=new Il.Files(this._client),this.fileBatches=new Rl.FileBatches(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return(0,jl.isRequestOptions)(e)?this.list({},e):this._client.getAPIList("/vector_stores",Ml,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/search`,Fl,{body:t,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}dl.VectorStores=xl;class Ml extends Cl.CursorPage{}dl.VectorStoresPage=Ml;class Fl extends Cl.Page{}dl.VectorStoreSearchResponsesPage=Fl,xl.VectorStoresPage=Ml,xl.VectorStoreSearchResponsesPage=Fl,xl.Files=Sl.Files,xl.VectorStoreFilesPage=Sl.VectorStoreFilesPage,xl.FileContentResponsesPage=Sl.FileContentResponsesPage,xl.FileBatches=El.FileBatches,function(t){var r=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),n=e&&e.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.VectorStores=t.VectorStoreSearchResponsesPage=t.VectorStoresPage=t.Uploads=t.Responses=t.Moderations=t.Models=t.ModelsPage=t.Images=t.Graders=t.FineTuning=t.Files=t.FileObjectsPage=t.Evals=t.EvalListResponsesPage=t.Embeddings=t.Completions=t.Beta=t.Batches=t.BatchesPage=t.Audio=void 0,n(fe,t),n(Se,t);var s=Ce;Object.defineProperty(t,"Audio",{enumerable:!0,get:function(){return s.Audio}});var o=ot;Object.defineProperty(t,"BatchesPage",{enumerable:!0,get:function(){return o.BatchesPage}}),Object.defineProperty(t,"Batches",{enumerable:!0,get:function(){return o.Batches}});var i=At;Object.defineProperty(t,"Beta",{enumerable:!0,get:function(){return i.Beta}});var a=Ws;Object.defineProperty(t,"Completions",{enumerable:!0,get:function(){return a.Completions}});var l=Xs;Object.defineProperty(t,"Embeddings",{enumerable:!0,get:function(){return l.Embeddings}});var c=eo;Object.defineProperty(t,"EvalListResponsesPage",{enumerable:!0,get:function(){return c.EvalListResponsesPage}}),Object.defineProperty(t,"Evals",{enumerable:!0,get:function(){return c.Evals}});var u=So;Object.defineProperty(t,"FileObjectsPage",{enumerable:!0,get:function(){return u.FileObjectsPage}}),Object.defineProperty(t,"Files",{enumerable:!0,get:function(){return u.Files}});var d=Lo;Object.defineProperty(t,"FineTuning",{enumerable:!0,get:function(){return d.FineTuning}});var f=Xi;Object.defineProperty(t,"Graders",{enumerable:!0,get:function(){return f.Graders}});var p=sa;Object.defineProperty(t,"Images",{enumerable:!0,get:function(){return p.Images}});var h=da;Object.defineProperty(t,"ModelsPage",{enumerable:!0,get:function(){return h.ModelsPage}}),Object.defineProperty(t,"Models",{enumerable:!0,get:function(){return h.Models}});var m=ga;Object.defineProperty(t,"Moderations",{enumerable:!0,get:function(){return m.Moderations}});var g=Ka();Object.defineProperty(t,"Responses",{enumerable:!0,get:function(){return g.Responses}});var b=Ga;Object.defineProperty(t,"Uploads",{enumerable:!0,get:function(){return b.Uploads}});var y=dl;Object.defineProperty(t,"VectorStoresPage",{enumerable:!0,get:function(){return y.VectorStoresPage}}),Object.defineProperty(t,"VectorStoreSearchResponsesPage",{enumerable:!0,get:function(){return y.VectorStoreSearchResponsesPage}}),Object.defineProperty(t,"VectorStores",{enumerable:!0,get:function(){return y.VectorStores}})}(de),function(t,r){var n,o=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t};Object.defineProperty(r,"__esModule",{value:!0}),r.UnprocessableEntityError=r.PermissionDeniedError=r.InternalServerError=r.AuthenticationError=r.BadRequestError=r.RateLimitError=r.ConflictError=r.NotFoundError=r.APIUserAbortError=r.APIConnectionTimeoutError=r.APIConnectionError=r.APIError=r.OpenAIError=r.fileFromPath=r.toFile=r.AzureOpenAI=r.OpenAI=void 0;const l=a(s),c=a(ie()),u=a(Q());a(ae);const d=a(oe),f=a(de),p=ot,h=Ws,m=Xs,g=So,b=sa,y=da,_=ga,v=Ce,w=At,P=pe,O=eo,A=Lo,j=Xi,R=Ka(),E=Ga,I=dl,S=ve();class C extends c.APIClient{
/**
	     * API Client for interfacing with the OpenAI API.
	     *
	     * @param {string | undefined} [opts.apiKey=process.env['OPENAI_API_KEY'] ?? undefined]
	     * @param {string | null | undefined} [opts.organization=process.env['OPENAI_ORG_ID'] ?? null]
	     * @param {string | null | undefined} [opts.project=process.env['OPENAI_PROJECT_ID'] ?? null]
	     * @param {string} [opts.baseURL=process.env['OPENAI_BASE_URL'] ?? https://api.openai.com/v1] - Override the default base URL for the API.
	     * @param {number} [opts.timeout=10 minutes] - The maximum amount of time (in milliseconds) the client will wait for a response before timing out.
	     * @param {number} [opts.httpAgent] - An HTTP agent used to manage HTTP(s) connections.
	     * @param {Core.Fetch} [opts.fetch] - Specify a custom `fetch` function implementation.
	     * @param {number} [opts.maxRetries=2] - The maximum number of times the client will retry a request.
	     * @param {Core.Headers} opts.defaultHeaders - Default headers to include with every request to the API.
	     * @param {Core.DefaultQuery} opts.defaultQuery - Default query parameters to include with every request to the API.
	     * @param {boolean} [opts.dangerouslyAllowBrowser=false] - By default, client-side use of this library is not allowed, as it risks exposing your secret API credentials to attackers.
	     */
constructor({baseURL:e=c.readEnv("OPENAI_BASE_URL"),apiKey:t=c.readEnv("OPENAI_API_KEY"),organization:r=c.readEnv("OPENAI_ORG_ID")??null,project:n=c.readEnv("OPENAI_PROJECT_ID")??null,...s}={}){if(void 0===t)throw new u.OpenAIError("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:r,project:n,...s,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&c.isRunningInBrowser())throw new u.OpenAIError("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new f.Completions(this),this.chat=new f.Chat(this),this.embeddings=new f.Embeddings(this),this.files=new f.Files(this),this.images=new f.Images(this),this.audio=new f.Audio(this),this.moderations=new f.Moderations(this),this.models=new f.Models(this),this.fineTuning=new f.FineTuning(this),this.graders=new f.Graders(this),this.vectorStores=new f.VectorStores(this),this.beta=new f.Beta(this),this.batches=new f.Batches(this),this.uploads=new f.Uploads(this),this.responses=new f.Responses(this),this.evals=new f.Evals(this),this._options=o,this.apiKey=t,this.organization=r,this.project=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return l.stringify(e,{arrayFormat:"brackets"})}}r.OpenAI=C,n=C,C.OpenAI=n,C.DEFAULT_TIMEOUT=6e5,C.OpenAIError=u.OpenAIError,C.APIError=u.APIError,C.APIConnectionError=u.APIConnectionError,C.APIConnectionTimeoutError=u.APIConnectionTimeoutError,C.APIUserAbortError=u.APIUserAbortError,C.NotFoundError=u.NotFoundError,C.ConflictError=u.ConflictError,C.RateLimitError=u.RateLimitError,C.BadRequestError=u.BadRequestError,C.AuthenticationError=u.AuthenticationError,C.InternalServerError=u.InternalServerError,C.PermissionDeniedError=u.PermissionDeniedError,C.UnprocessableEntityError=u.UnprocessableEntityError,C.toFile=d.toFile,C.fileFromPath=d.fileFromPath,C.Completions=h.Completions,C.Chat=P.Chat,C.ChatCompletionsPage=S.ChatCompletionsPage,C.Embeddings=m.Embeddings,C.Files=g.Files,C.FileObjectsPage=g.FileObjectsPage,C.Images=b.Images,C.Audio=v.Audio,C.Moderations=_.Moderations,C.Models=y.Models,C.ModelsPage=y.ModelsPage,C.FineTuning=A.FineTuning,C.Graders=j.Graders,C.VectorStores=I.VectorStores,C.VectorStoresPage=I.VectorStoresPage,C.VectorStoreSearchResponsesPage=I.VectorStoreSearchResponsesPage,C.Beta=w.Beta,C.Batches=p.Batches,C.BatchesPage=p.BatchesPage,C.Uploads=E.Uploads,C.Responses=R.Responses,C.Evals=O.Evals,C.EvalListResponsesPage=O.EvalListResponsesPage;class x extends C{
/**
	     * API Client for interfacing with the Azure OpenAI API.
	     *
	     * @param {string | undefined} [opts.apiVersion=process.env['OPENAI_API_VERSION'] ?? undefined]
	     * @param {string | undefined} [opts.endpoint=process.env['AZURE_OPENAI_ENDPOINT'] ?? undefined] - Your Azure endpoint, including the resource, e.g. `https://example-resource.azure.openai.com/`
	     * @param {string | undefined} [opts.apiKey=process.env['AZURE_OPENAI_API_KEY'] ?? undefined]
	     * @param {string | undefined} opts.deployment - A model deployment, if given, sets the base client URL to include `/deployments/{deployment}`.
	     * @param {string | null | undefined} [opts.organization=process.env['OPENAI_ORG_ID'] ?? null]
	     * @param {string} [opts.baseURL=process.env['OPENAI_BASE_URL']] - Sets the base URL for the API, e.g. `https://example-resource.azure.openai.com/openai/`.
	     * @param {number} [opts.timeout=10 minutes] - The maximum amount of time (in milliseconds) the client will wait for a response before timing out.
	     * @param {number} [opts.httpAgent] - An HTTP agent used to manage HTTP(s) connections.
	     * @param {Core.Fetch} [opts.fetch] - Specify a custom `fetch` function implementation.
	     * @param {number} [opts.maxRetries=2] - The maximum number of times the client will retry a request.
	     * @param {Core.Headers} opts.defaultHeaders - Default headers to include with every request to the API.
	     * @param {Core.DefaultQuery} opts.defaultQuery - Default query parameters to include with every request to the API.
	     * @param {boolean} [opts.dangerouslyAllowBrowser=false] - By default, client-side use of this library is not allowed, as it risks exposing your secret API credentials to attackers.
	     */
constructor({baseURL:e=c.readEnv("OPENAI_BASE_URL"),apiKey:t=c.readEnv("AZURE_OPENAI_API_KEY"),apiVersion:r=c.readEnv("OPENAI_API_VERSION"),endpoint:n,deployment:s,azureADTokenProvider:o,dangerouslyAllowBrowser:i,...a}={}){if(!r)throw new u.OpenAIError("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");if("function"==typeof o&&(i=!0),!o&&!t)throw new u.OpenAIError("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(o&&t)throw new u.OpenAIError("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");if(t??(t=F),a.defaultQuery={...a.defaultQuery,"api-version":r},e){if(n)throw new u.OpenAIError("baseURL and endpoint are mutually exclusive")}else{if(n||(n=process.env.AZURE_OPENAI_ENDPOINT),!n)throw new u.OpenAIError("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");e=`${n}/openai`}super({apiKey:t,baseURL:e,...a,...void 0!==i?{dangerouslyAllowBrowser:i}:{}}),this.apiVersion="",this._azureADTokenProvider=o,this.apiVersion=r,this.deploymentName=s}buildRequest(e,t={}){if(M.has(e.path)&&"post"===e.method&&void 0!==e.body){if(!c.isObj(e.body))throw new Error("Expected request body to be an object");const t=this.deploymentName||e.body.model||e.__metadata?.model;void 0===t||this.baseURL.includes("/deployments")||(e.path=`/deployments/${t}${e.path}`)}return super.buildRequest(e,t)}async _getAzureADToken(){if("function"==typeof this._azureADTokenProvider){const e=await this._azureADTokenProvider();if(!e||"string"!=typeof e)throw new u.OpenAIError(`Expected 'azureADTokenProvider' argument to return a string but it returned ${e}`);return e}}authHeaders(e){return{}}async prepareOptions(e){if(e.headers?.["api-key"])return super.prepareOptions(e);const t=await this._getAzureADToken();if(e.headers??(e.headers={}),t)e.headers.Authorization=`Bearer ${t}`;else{if(this.apiKey===F)throw new u.OpenAIError("Unable to handle auth");e.headers["api-key"]=this.apiKey}return super.prepareOptions(e)}}r.AzureOpenAI=x;const M=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]),F="<Missing Key>";var k=oe;Object.defineProperty(r,"toFile",{enumerable:!0,get:function(){return k.toFile}}),Object.defineProperty(r,"fileFromPath",{enumerable:!0,get:function(){return k.fileFromPath}});var T=Q();Object.defineProperty(r,"OpenAIError",{enumerable:!0,get:function(){return T.OpenAIError}}),Object.defineProperty(r,"APIError",{enumerable:!0,get:function(){return T.APIError}}),Object.defineProperty(r,"APIConnectionError",{enumerable:!0,get:function(){return T.APIConnectionError}}),Object.defineProperty(r,"APIConnectionTimeoutError",{enumerable:!0,get:function(){return T.APIConnectionTimeoutError}}),Object.defineProperty(r,"APIUserAbortError",{enumerable:!0,get:function(){return T.APIUserAbortError}}),Object.defineProperty(r,"NotFoundError",{enumerable:!0,get:function(){return T.NotFoundError}}),Object.defineProperty(r,"ConflictError",{enumerable:!0,get:function(){return T.ConflictError}}),Object.defineProperty(r,"RateLimitError",{enumerable:!0,get:function(){return T.RateLimitError}}),Object.defineProperty(r,"BadRequestError",{enumerable:!0,get:function(){return T.BadRequestError}}),Object.defineProperty(r,"AuthenticationError",{enumerable:!0,get:function(){return T.AuthenticationError}}),Object.defineProperty(r,"InternalServerError",{enumerable:!0,get:function(){return T.InternalServerError}}),Object.defineProperty(r,"PermissionDeniedError",{enumerable:!0,get:function(){return T.PermissionDeniedError}}),Object.defineProperty(r,"UnprocessableEntityError",{enumerable:!0,get:function(){return T.UnprocessableEntityError}}),r=t.exports=C,t.exports.AzureOpenAI=x,r.default=C}(n,n.exports);var kl=n.exports;const{OpenAI:Tl}=kl;var $l=class{#e={providers:{},models:[]};#t=[];
/**
   * Create an asak instance
   * åˆ›å»ºasakå®žä¾‹
   * 
   * @param {Object} config - Configuration object
   * @param {Object} config.providers - AI providers configuration
   * @param {Array} config.models - AI models configuration
   * @throws {Error} If configuration is invalid
   * 
   * @example
   * const config = {
   *   providers: {
   *     'provider1': { base_url: '...', key: '...' }
   *   },
   *   models: [
   *     { provider: 'provider1', model: 'gpt-4', rate_limit: { rpm: 3, rpd: 200 } }
   *   ]
   * };
   * 
   * @example
   * // é…ç½®ç¤ºä¾‹
   * const config = {
   *   providers: {
   *     'provider1': { base_url: '...', key: '...' }
   *   },
   *   models: [
   *     { provider: 'provider1', model: 'gpt-4', rate_limit: { rpm: 3, rpd: 200 } }
   *   ]
   * };
   */
constructor(e){if(!this.#r(e))throw new Error("Err when reading config");this.#e=e,this.#t=[];try{for(let e=0;e<this.#e.models.length;e++)this.#t.push({m:[],d:[],limit_m:this.#e.models[e].rate_limit.rpm,limit_d:this.#e.models[e].rate_limit.rpd})}catch(e){throw new Error("Err when initializing models")}}
/**
   * Validate configuration object
   * éªŒè¯é…ç½®å¯¹è±¡æ˜¯å¦æœ‰æ•ˆ
   * 
   * @private
   * @param {Object} config - Configuration object to validate
   * @returns {boolean} True if config is valid
   */#r(e){return!(!e||"object"!=typeof e)&&(!(!e.providers||"object"!=typeof e.providers||Object.values(e.providers).some(e=>"object"!=typeof e||"string"!=typeof e.base_url||"string"!=typeof e.key))&&(!(!Array.isArray(e.models)||0===e.models.length)&&!e.models.some(t=>"object"!=typeof t||"string"!=typeof t.provider||"string"!=typeof t.model||"object"!=typeof t.rate_limit||"number"!=typeof t.rate_limit.rpm||"number"!=typeof t.rate_limit.rpd||t.rate_limit.rpm<=0||t.rate_limit.rpd<=0||t.provider in e.providers==!1)))}
/**
   * Validate records object
   * éªŒè¯è®°å½•å¯¹è±¡æ˜¯å¦æœ‰æ•ˆ
   * 
   * @private
   * @param {Array} records - Records to validate
   * @returns {boolean} True if records are valid
   */#n(e){if(!Array.isArray(e)||e.length!==this.#t.length)return!1;for(let t=0;t<e.length;t++){const r=e[t];if(!r||!Array.isArray(r.m)||!Array.isArray(r.d)||r.limit_m!==this.#t[t].limit_m||r.limit_d!==this.#t[t].limit_d)return!1}return!0}#s(){let e=Date.now(),t=[];for(let r=0;r<this.#t.length;r++){t.push({m:[],d:[],limit_m:this.#t[r].limit_m,limit_d:this.#t[r].limit_d});for(let n=0;n<this.#t[r].m.length;n++)e-this.#t[r].m[n]<6e4&&t[r].m.push(this.#t[r].m[n]);for(let n=0;n<this.#t[r].d.length;n++)e-this.#t[r].d[n]<864e5&&t[r].d.push(this.#t[r].d[n])}this.#t=t}recorder={
/**
     * Get all records
     * èŽ·å–æ‰€æœ‰è®°å½•
     * @returns {Array} Current records
     */
get:()=>(this.#s(),this.#t),
/**
     * Replace all records
     * æ›¿æ¢æ‰€æœ‰è®°å½•
     * @param {Array} records - New records to replace with
     * @throws {Error} If records format is invalid
     */
replace:e=>{if(!this.#n(e))throw new Error("Invalid records format");this.#t=e,this.#s()},
/**
     * Add records
     * è¿½åŠ è®°å½•
     * @param {Array} records - Records to append
     * @returns {Array} Merged records
     * @throws {Error} If records format is invalid
     */
add:e=>{if(!this.#n(e))throw new Error("Invalid records format");for(let t=0;t<e.length;t++)this.#t[t].m.push(...e[t].m),this.#t[t].d.push(...e[t].d);this.#s()},
/**
     * Record model usage
     * è®°å½•æ¨¡åž‹ä½¿ç”¨æƒ…å†µ
     * @param {number} [index] - Model index
     * @param {Function} [find] - Filter function (i, m) => boolean
     * @throws {Error} If neither index nor find is provided
     */
use:(()=>{var e=this;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===t&&null===r)throw new Error("Either index or find param is required");if(null===t&&null!==r){if("function"!=typeof r)throw new Error("`find` param is not a function");{let n=0;for(;;){if(n>=e.#t.length)return;if(r(n,e.#e.models[n])){t=n;break}n++}}}e.#t[t].m.push(Date.now()),e.#t[t].d.push(Date.now()),e.#s()}})()};
/**
   * Check if model is available
   * æ£€æŸ¥æ¨¡åž‹æ˜¯å¦å¯ç”¨
   * 
   * @private
   * @param {number} i - Model index
   * @returns {boolean} True if model is available
   */
#o(e){return this.#t[e].m.length<this.#t[e].limit_m&&this.#t[e].d.length<this.#t[e].limit_d}
/**
   * Calculate model availability
   * è®¡ç®—æ¨¡åž‹å¯ç”¨æ€§
   * 
   * @private
   * @param {number} i - Model index
   * @returns {number} Availability score (0-1)
   */#i(e){let t=(this.#t[e].limit_m-this.#t[e].m.length)/this.#t[e].limit_m,r=(this.#t[e].limit_d-this.#t[e].d.length)/this.#t[e].limit_d;return Math.min(t,r)}
/**
   * Get an available model
   * èŽ·å–å¯ç”¨æ¨¡åž‹
   * 
   * @param {string} mode - Selection mode ('index', 'available', 'random')
   * @param {Function} [filter] - Optional filter function (i, m) => boolean
   * @returns {Object} Selected model info
   * @throws {Error} If no model is available
   * 
   * @example
   * const model = client.get_model('available', (i, m) => m.tags.includes('gpt'));
   * 
   * @example
   * // èŽ·å–æ¨¡åž‹ç¤ºä¾‹
   * const model = client.get_model('available', (i, m) => m.tags.includes('gpt'));
   */get_model(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>!0;this.#s();let r,n=[];if("function"!=typeof t)throw new Error("Filter param is not a function");for(let e=0;e<this.#e.models.length;e++)t(e,this.#e.models[e])&&this.#o(e)&&n.push(e);if(0===n.length)throw new Error("No model is available");switch(e){case"index":r=Math.min(...n);break;case"available":r=n.sort((e,t)=>this.#i(t)-this.#i(e))[0];break;case"random":r=n[Math.floor(Math.random()*n.length)];break;default:throw new Error("Mode param is not valid")}return this.#t[r].m.push(Date.now()),this.#t[r].d.push(Date.now()),{provider:this.#e.models[r].provider,base_url:this.#e.providers[this.#e.models[r].provider].base_url,key:this.#e.providers[this.#e.models[r].provider].key,model:this.#e.models[r].model}}
/**
   * Make an API request
   * å‘èµ·APIè¯·æ±‚
   * 
   * @param {string} mode - Selection mode ('index', 'available', 'random')
   * @param {Function} [filter] - Optional filter function (i, m) => boolean
   * @param {Array} messages - Chat messages array
   * @param {boolean} [is_stream=true] - Whether to use streaming
   * @returns {Promise<Object>} API response
   * 
   * @example
   * const response = await client.request('available', null, [
   *   { role: 'user', content: 'Hello' }
   * ]);
   * 
   * @example
   * // è¯·æ±‚ç¤ºä¾‹
   * const response = await client.request('available', null, [
   *   { role: 'user', content: 'ä½ å¥½' }
   * ]);
   */async request(e,t,r){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=this.get_model(e,t),o=new Tl({baseURL:s.base_url,apiKey:s.key,dangerouslyAllowBrowser:!0}),i=await o.chat.completions.create({model:s.model,stream:n,messages:r});if(n){let e=async function*(){for await(const e of i){const t=e.choices?.[0]?.delta?.content;void 0!==t&&(yield t)}};return{provider:s.provider,base_url:s.base_url,key:s.key,model:s.model,delta:{[Symbol.asyncIterator]:e},original:i}}return{provider:s.provider,base_url:s.base_url,key:s.key,model:s.model,message:i.choices[0].message,original:i}}},Bl=t($l);module.exports=Bl;
//# sourceMappingURL=asakjs.cjs.js.map
